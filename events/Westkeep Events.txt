add_namespace = westkeep
add_namespace = westkeep_flavour
add_namespace = westkeep_debug

country_event = { #Westkeep revolution paths, MPA republicans or the Neutrality Countess
	id = westkeep.1
	immediate = {log = "[GetDateText]: [Root.GetName]: event westkeep.1"}
	title = westkeep.1.t
	desc = westkeep.1.d
	picture = GFX_event_medieval_castle_on_hill
	fire_only_once = yes
	is_triggered_only = yes
	option = { #side with the Marquess
		name = westkeep.1.a
		ai_chance = {
			factor = 50
		}
		custom_effect_tooltip = JRR_option_1_tp
		hidden_effect = {
			set_country_flag = JRR_monarchist
			set_politics = {
				ruling_party = neutrality
				elections_allowed = no
			}
			load_focus_tree = {
			    tree = westkeep_focus_marquess_1
			    keep_completed = yes
		    }
			complete_national_focus = JRR_b1
			JRR_marquess_aurel_discret = {
			    add_field_marshal_role = {
				    traits = { 
	                    griffon_race_trait 
						brilliant_strategist
						fast_planner
	                }
					desc = JRR_AUREL_DISCRET_DESC
                    skill = 2
                    attack_skill = 1
                    defense_skill = 2
                    planning_skill = 3
                    logistics_skill = 3
                }
			}
			JRR_aurelien_discret = {
			    add_corps_commander_role = {
				    traits = { 
	                    griffon_race_trait 
						promising_general
						brilliant_strategist
						infantry_leader
	                }
					desc = JRR_AURELIEN_DISCRET_DESC
                    skill = 2
                    attack_skill = 2
                    defense_skill = 2
                    planning_skill = 2
                    logistics_skill = 3
                }
			}
			add_ideas = JRR_MPA_resistance
			add_ideas = JRR_legacy_of_serfdom
			activate_mission = JRR_revolutionary_gain_support_mission
		}
		add_to_array = { JER_revolution_countries = JRR }
		set_variable = { JERrev_selected_country = JRR }
	}
	option = { #side with the Colonel
		name = westkeep.1.b
		ai_chance = {
			factor = 50
		}
		custom_effect_tooltip = JRR_option_2_tp
		hidden_effect = {
			set_country_flag = JRR_revolutionary
			set_politics = {
				ruling_party = fascism
				elections_allowed = no
			}
			load_focus_tree = {
			    tree = westkeep_focus_colonel_1
			    keep_completed = yes
		    }
			complete_national_focus = JRR_a1
			JRR_colonel_colette_solide = {
			    add_field_marshal_role = {
				    traits = { 
	                    griffon_race_trait 
						politically_connected
						aggressive_assaulter
	                }
					desc = JRR_COLETTE_SOLIDE_DESC
                    skill = 3
                    attack_skill = 4
                    defense_skill = 2
                    planning_skill = 2
                    logistics_skill = 2
                }
			}
			JRR_rouge_guirlande = {
			    add_corps_commander_role = {
				    traits = { 
	                    pony_race_trait 
						hill_fighter
						trait_mountaineer
						adaptable
	                }
					desc = JRR_ROUGE_GUIRLANDE_DESC
                    skill = 3
                    attack_skill = 2
                    defense_skill = 1
                    planning_skill = 4
                    logistics_skill = 4
                }
			}
			add_ideas = JRR_marquess_resistance
			add_ideas = JRR_legacy_of_serfdom
			activate_mission = JRR_monarchist_gain_support_mission
		}
		add_to_array = { JER_revolution_countries = JRR }
		set_variable = { JERrev_selected_country = JRR }
	}
}

country_event = { #Aurele and her buddies manage to retake Westkeep fully
	id = westkeep.2
	immediate = {log = "[GetDateText]: [Root.GetName]: event westkeep.2"}
	title = westkeep.2.t
	desc = westkeep.2.d
	picture = GFX_event_medieval_castle_on_hill
	fire_only_once = yes
	is_triggered_only = yes
	option = {
		name = westkeep.2.a
		hidden_effect = {
			if = {
			    limit = {
				    JER = {
					    has_completed_focus = JER_fight_for_freedom
					}
				}
			    JER = { 
				    end_puppet = JRR 
				}
			    JRR = { 
				    drop_cosmetic_tag = yes 
				}
			    if = {
				    limit = {
					    JRR = {
						    is_in_faction_with = JER
					    }
				    }
				    JRR = {
					    leave_faction = yes
				    }
			    }
		    }
			if = {
				limit = { 
					JER = { 
						has_completed_focus = JER_fight_for_freedom 
					} 
				}
				declare_war_on = {
					target = JER
					type = annex_everything
				}
			}
			if = {
			    limit = {
				    has_country_flag = JRR_revolutionary
				}
				clear_republican_spirits = yes
				set_country_flag = JRR_monarchist
			}
			load_focus_tree = {
			    tree = westkeep_focus_revolution
			    keep_completed = yes
		    }
			complete_national_focus = JRR_c1
		}
	}
}

country_event = { #Revolutionaries Take Control of Westkeep and kill off the Marquess and her family
	id = westkeep.3
	immediate = {log = "[GetDateText]: [Root.GetName]: event westkeep.3"}
	title = westkeep.3.t
	desc = westkeep.3.d
	picture = GFX_event_griffon_back
	fire_only_once = yes
	is_triggered_only = yes
	option = {
	    ai_chance = {
			base = 10
		}
		name = westkeep.3.a
		custom_effect_tooltip = JRR_maintain_loyalty_tp
		hidden_effect = {
		    retire_character = JRR_marquess_aurel_discret
			retire_character = JRR_aurelien_discret
			add_country_leader_role = {
			    character = JRR_lance_incarnat
			    promote_leader = yes
			    country_leader = {
				    expire = "1965.1.1"
				    desc = JRR_LANCE_INCARNAT_DESC
				    ideology = despotism
				    traits = { 
					    JRR_vampire_patriarch
					}
			    }
            }
			if = {
			    limit = {
				    JER = {
					    has_completed_focus = JER_state_of_aquileia
					}
				}
			    JER = { 
				    end_puppet = JRR 
				}
			    JRR = { 
				    drop_cosmetic_tag = yes 
				}
			    if = {
				    limit = {
					    JRR = {
						    is_in_faction_with = JER
					    }
				    }
				    JRR = {
					    leave_faction = yes
				    }
			    }
		    }
			if = {
				limit = { 
					JER = { 
						has_completed_focus = JER_state_of_aquileia
					} 
				}
				declare_war_on = {
					target = JER
					type = annex_everything
				}
			}
			if = {
			    limit = {
				    has_country_flag = JRR_monarchist
				}
				clear_monarchist_spirts = yes
				set_country_flag = JRR_revolutionary
			}
			load_focus_tree = {
			    tree = westkeep_focus_revolution
			    keep_completed = yes
		    }
			complete_national_focus = JRR_c1
		}
	}
	option = {
	    ai_chance = {
			base = 90
			modifier = {
				factor = 0
				JER = {
				    is_ai = no
				}
			}
		}
		name = westkeep.3.b
		custom_effect_tooltip = JRR_become_the_third_position_tp
		hidden_effect = {
		    retire_character = JRR_marquess_aurel_discret
			retire_character = JRR_aurelien_discret
			add_country_leader_role = {
			    character = JRR_lance_incarnat
			    promote_leader = yes
			    country_leader = {
				    expire = "1965.1.1"
				    desc = JRR_LANCE_INCARNAT_DESC
				    ideology = despotism
				    traits = { 
					    JRR_vampire_patriarch
					}
			    }
            }
			JER = { 
				end_puppet = JRR 
			}
			JRR = { 
				drop_cosmetic_tag = yes 
			}
			if = {
				limit = {
					JRR = {
						is_in_faction_with = JER
					}
				}
				JRR = {
					leave_faction = yes
				}
		    }
			declare_war_on = {
				target = JER
				type = annex_everything
			}
			declare_war_on = {
				target = JFT
				type = annex_everything
			}
			declare_war_on = {
				target = JEB
				type = annex_everything
			}
			declare_war_on = {
				target = VIN
				type = annex_everything
			}
			if = {
			    limit = {
				    has_country_flag = JRR_monarchist
				}
				clear_monarchist_spirts = yes
				set_country_flag = JRR_revolutionary
			}
			load_focus_tree = {
			    tree = westkeep_focus_revolution
			    keep_completed = yes
		    }
			complete_national_focus = JRR_c1
			set_cosmetic_tag = JRR_JER_directory
		}
	}
}

country_event = { #Westkeep wins the Revolution in the end
	id = westkeep.4
	immediate = {log = "[GetDateText]: [Root.GetName]: event westkeep_debug.4"}
	title = westkeep.4.t
	desc = {
		text = westkeep.4.d_1
		trigger = {
		    has_country_flag = JRR_monarchist
		}
	}
	desc = {
		text = westkeep.4.d_2
		trigger = {
		    has_country_flag = JRR_revolutionary
		}
	}
	picture = GFX_event_griffon_back
	fire_only_once = yes
	is_triggered_only = yes
	
	option = {
	    trigger = {
		    has_country_flag = JRR_monarchist
		}
		name = westkeep.4.a
		hidden_effect = {
		    set_cosmetic_tag = JRR_JER
			if = {
			    limit = {
				    NOT = {
					    has_global_flag = JER_revolution_ended
					}
				}
				set_global_flag = JER_revolution_ended
			}
			bring_to_aquileian_level = yes
		}
	}
	option = {
	    trigger = {
		    has_country_flag = JRR_revolutionary
		}
		name = westkeep.4.b
		hidden_effect = {
			if = {
			    limit = {
				    NOT = {
					    has_global_flag = JER_revolution_ended
					}
				}
				set_global_flag = JER_revolution_ended
			}
			bring_to_aquileian_level = yes
		}
	}
}

country_event = { #Monarchist Support Debug
	id = westkeep_debug.1
	immediate = {log = "[GetDateText]: [Root.GetName]: event westkeep_debug.1"}
	title = westkeep_debug.1.t
	desc = westkeep_debug.1.d
	picture = GFX_event_medieval_castle_on_hill

	is_triggered_only = yes
	hidden = yes
	
	option = {
		name = westkeep_debug.1.a
		activate_mission = JRR_monarchist_gain_support_mission
	}
}

country_event = { #Republican Support Debug
	id = westkeep_debug.2
	immediate = {log = "[GetDateText]: [Root.GetName]: event westkeep_debug.2"}
	title = westkeep_debug.2.t
	desc = westkeep_debug.2.d
	picture = GFX_event_medieval_castle_on_hill

	is_triggered_only = yes
	hidden = yes
	
	option = {
		name = westkeep_debug.2.a
		activate_mission = JRR_revolutionary_gain_support_mission
	}
}

country_event = { #60 days debug
	id = westkeep_debug.3
	immediate = {log = "[GetDateText]: [Root.GetName]: event westkeep_debug.3"}
	title = westkeep_debug.3.t
	desc = westkeep_debug.3.d
	picture = GFX_event_medieval_castle_on_hill

	is_triggered_only = yes
	hidden = yes
	
	option = {
		name = westkeep_debug.3.a
		add_country_flag = JRR_60_days_passed
	}
}

country_event = { #40 days debug
	id = westkeep_debug.4
	immediate = {log = "[GetDateText]: [Root.GetName]: event westkeep_debug.4"}
	title = westkeep_debug.4.t
	desc = westkeep_debug.4.d
	picture = GFX_event_medieval_castle_on_hill

	is_triggered_only = yes
	hidden = yes
	
	option = {
		name = westkeep_debug.4.a
		add_country_flag = JRR_40_days_passed
	}
}