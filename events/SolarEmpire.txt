add_namespace = solarempire
add_namespace = solarempiresparkles

country_event = {
  id = solarempire.1
  title = solarempire.1.t
  desc = solarempire.1.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempire.1.a
    if = {
      limit = { country_exists = CRY CRY = { has_government = democratic } }
      CRY = { country_event = { id = solarempire.2 days = 2 } } #pressure cadence
      else = {
        random_country = {
          limit = {
            original_tag = CRY
            has_government = democratic
          }
          country_event = { id = solarempire.2 days = 2 }
        }
      }
    }
    ai_chance = {
      factor = 1
      modifier = {
        factor = 2
        has_completed_focus = SOL_empress_protector
      }
    }
  }
  option = {
    name = solarempire.1.b
    if = {
      limit = { country_exists = CRY CRY = { has_government = democratic } }
      CRY = { country_event = { id = solarempire.3 days = 2 } } #replace cadence
      else = {
        random_country = {
          limit = {
            original_tag = CRY
            has_government = democratic
          }
          country_event = { id = solarempire.3 days = 2 }
        }
      }
    }
    ai_chance = {
      factor = 1
      modifier = {
        factor = 2
        has_completed_focus = SOL_empress_mother
      }
    }
  }
  option = {
    name = solarempire.1.c
    if = {
      limit = { country_exists = CRY CRY = { has_government = democratic } }
      CRY = { country_event = { id = solarempire.4 days = 2 } } #annex CRY
      else = {
        random_country = {
          limit = {
            original_tag = CRY
            has_government = democratic
          }
          country_event = { id = solarempire.4 days = 2 }
        }
      }
    }
    ai_chance = {
      factor = 1
      modifier = {
        factor = 2
        has_completed_focus = SOL_god_empress
      }
    }
  }
}

#For CRY
country_event = {
  id = solarempire.2
  title = solarempire.2.t
  desc = solarempire.2.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempire.2.a
    add_political_power = -100
    hidden_effect = {
      set_country_flag = SOL_CRY_force_protectorate_replace
      FROM = { country_event = { id = solarempire.5 days = 1 }}
    }
    ai_chance = {
      factor = 2
      modifier = {
        factor = 0
        strength_ratio = { tag = SOL ratio > 0.8 }
      }
    }
  }
  option = {
    name = solarempire.2.b
    add_political_power = 100
    FROM = { country_event = { id = solarempire.5 days = 1 }}
    ai_chance = {
      factor = 1
      modifier = {
        factor = 1.2
        democratic > 0.8
      }
    }
  }
}

#For CRY
country_event = {
  id = solarempire.3
  title = solarempire.3.t
  desc = solarempire.3.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempire.3.a
    add_political_power = -100
    hidden_effect = {
      set_country_flag = SOL_CRY_force_protectorate
      FROM = { country_event = { id = solarempire.5 days = 1 }}
    }
    ai_chance = {
      factor = 2
      modifier = {
        factor = 0
        strength_ratio = { tag = SOL ratio > 0.8 }
      }
    }
  }
  option = {
    name = solarempire.3.b
    add_political_power = 100
    FROM = { country_event = { id = solarempire.5 days = 1 }}
    ai_chance = {
      factor = 1
      modifier = {
        factor = 1.2
        democratic > 0.8
      }
    }
  }
}

#For CRY
country_event = {
  id = solarempire.4
  title = solarempire.4.t
  desc = solarempire.4.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempire.4.a
    custom_effect_tooltip = GAME_OVER_TT
    FROM = { annex_country = { target = ROOT transfer_troops = yes } }
    ai_chance = {
      factor = 1
      modifier = {
        factor = 0
        strength_ratio = { tag = FROM ratio > 0.8 }
      }
    }
  }
  option = {
    name = solarempire.4.b
    add_political_power = 100
    FROM = { country_event = { id = solarempire.5 days = 1 }}
    ai_chance = {
      factor = 1
    }
  }
}

country_event = {
  id = solarempire.5
  title = solarempire.5.t
  desc = {
    text = solarempire.5.d_agree
    trigger = {
      FROM = { has_country_flag = SOL_CRY_force_protectorate }
    }
  }
  desc = {
    text = solarempire.5.d_agreegov
    trigger = {
      FROM = { has_country_flag = SOL_CRY_force_protectorate_replace }
    }
  }
  desc = {
    text = solarempire.5.d_noagree
    trigger = {
     NOT = {
      FROM = { has_country_flag = SOL_CRY_force_protectorate }
      FROM = { has_country_flag = SOL_CRY_force_protectorate_replace }
     }
    }
  }
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  immediate = {
    if = {
      limit = {
        FROM = { has_country_flag = SOL_CRY_force_protectorate } FROM = { has_country_flag = SOL_CRY_force_protectorate_replace }
      }
      if = {
        limit = { FROM = { is_subject_of = ROOT } }
        end_puppet = FROM
      }
      if = {
        limit = { FROM = { is_in_faction_with = ROOT } }
        remove_from_faction = FROM
      }
    }
  }

  option = {
    name = solarempire.5.a
    trigger = {
      FROM = {
        has_country_flag = SOL_CRY_force_protectorate
      }
    }
  }
  option = {
    name = solarempire.5.b
    trigger = {
      FROM = {
        has_country_flag = SOL_CRY_force_protectorate_replace
      }
    }
  }
  option = {
    name = solarempire.5.c
    trigger = {
      NOT  = { FROM = { has_country_flag = SOL_CRY_force_protectorate } FROM = { has_country_flag = SOL_CRY_force_protectorate_replace } }
    }
    add_political_power = -50
    create_wargoal = {
      type = annex_everything
      target = FROM
    }
  }
}

#For CRY
country_event = {
  id = solarempire.6
  title = solarempire.6.t
  desc = solarempire.6.d
  picture = GFX_event_solarempire

  is_triggered_only = yes

  option = { #Support luna
    name = solarempire.6.a
    reverse_add_opinion_modifier = { target = SOL modifier = cry_betrayal }
    if = {
      limit = { original_tag = CRY NOT = { has_completed_focus = CRY_subordination }  }
      end_puppet_this = yes
    }
    effect_tooltip = {
      add_to_war = {
        targeted_alliance = EQS enemy = SOL
      }
    }
    hidden_effect = {
      country_event = { id = equestria.162 days = 1 }
    }
    hidden_effect = {
      if = {
        limit = { is_subject = yes is_ai = no }
        set_rule = { can_decline_call_to_war = no }
      }
    }
    ai_chance = {
      factor = 2.5
    }
  }
  option = { #Stay neutral
    name = solarempire.6.b
    end_puppet_this = yes
    if = {
      limit = { is_in_faction_with = EQS }
      EQS = { remove_from_faction = ROOT }
    }
    reverse_add_opinion_modifier = { target = SOL modifier = cry_betrayal }
    reverse_add_opinion_modifier = { target = EQS modifier = cry_betrayal }
    hidden_effect = {
      if = {
        limit = { has_war_with = SOL }
        white_peace = SOL
      }
      set_country_flag = ignored_EQS_civil_war
    }
    ai_chance = {
      factor = 4
      modifier = {
        NOT = { is_pony_race = yes }
        factor = 3
      }
      modifier = {
        NOT = {
          is_neighbor_of = EQS
          is_neighbor_of = SOL
        }
        factor = 3
      }
    }
  }
  option = { #Support Daybreaker
    name = solarempire.6.c
    if = {
      limit = { is_subject_of = EQS }
      get_current_autonomy_level = yes
      set_country_flag = former_EQS_puppet
      overlord = { end_puppet = ROOT }
    }
    if = {
      limit = { is_in_faction_with = EQS }
      EQS = { remove_from_faction = ROOT }
    }
    hidden_effect = {
      if = {
        limit = { has_war_with = SOL }
        white_peace = SOL
      }
    }
    reverse_add_opinion_modifier = { target = EQS modifier = cry_betrayal }
    add_popularity = { ideology = democratic popularity = -0.1 }
    effect_tooltip = {
      add_to_war = {
        targeted_alliance = SOL enemy = EQS
      }
    }
    hidden_effect = {
      country_event = { id = equestria.160 days = 1 }
    }
    ai_chance = {
      factor = 1
      modifier = {
        factor = 1.5
        NOT = { original_tag = CRY }
      }
      modifier = {
        factor = 10
        has_government = fascism
      }
      modifier = {
        factor = 1.4
        has_autonomy_state = autonomy_integrated_puppet
      }
      modifier = {
        factor = 1.2
        has_autonomy_state = autonomy_puppet
      }
    }
  }
}

#For CRY
country_event = {
  id = solarempire.7
  title = solarempire.7.t
  desc = solarempire.7.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = { #k bend the knee
    name = solarempire.7.a
    add_political_power = -200
    get_current_government_type = yes
    SOL = { puppet = ROOT }
    restore_previous_government_type = yes
    add_autonomy_ratio = { value = 0.80 }
    ai_chance = {
      factor = 1
      modifier = {
        factor = 0
        strength_ratio = { tag = SOL ratio > 0.8 }
      }
    }
  }
  option = { #refuse
    name = solarempire.7.b
    add_political_power = 100
    SOL = { country_event = { id = solarempire.5 days = 1 } }
    ai_chance = {
      factor = 1
    }
  }
}

#Elements leave
country_event = {
  id = solarempire.8
  title = solarempire.8.t
  desc = solarempire.8.d
  picture = GFX_event_solarempire

  fire_only_once = yes

  trigger = {
    tag = SOL
    OR = {
      has_unit_leader = 50
      has_unit_leader = 70
      has_unit_leader = 90
      has_unit_leader = 100000
      NOT = { has_country_flag = SOL_harmonic_commanders_leave }
    }
  }

  mean_time_to_happen = {
    days = 180
    modifier = {
      factor = 2
      has_defensive_war = yes
    }
    modifier = {
      factor = 1.5
      NOT = {
        has_completed_focus = SOL_empress_mother
        has_completed_focus = SOL_god_empress
      }
    }
    modifier = {
      factor = 0.5
      has_offensive_war = yes
    }
    modifier = {
      factor = 0.1
      focus_progress = { focus = SOL_generals_loyality progress > 0.1 }
    }
    modifier = {
      factor = 0.01
      focus_progress = { focus = SOL_generals_loyality progress > 0.8 }
    }
    modifier = {
      factor = 0.001
      has_completed_focus = SOL_generals_loyality
    }
  }

  option = { #very well
    name = solarempire.8.a
    add_political_power = -20
    if = {
      limit = { has_unit_leader = 50 }
      remove_unit_leader = 50
    }
    if = {
      limit = { has_unit_leader = 70 }
      remove_unit_leader = 70
    }
    if = {
      limit = { has_unit_leader = 90 }
      remove_unit_leader = 90
    }
    if = {
      limit = { has_unit_leader = 100 }
      remove_unit_leader = 100
    }
    if = {
      limit = { has_unit_leader = 100000 }
      remove_unit_leader = 100000
    }
    set_country_flag = SOL_harmonic_commanders_leave
  }
}

#Rehabilitate generals
country_event = {
  id = solarempire.9
  title = solarempire.9.t
  desc = solarempire.9.d
  picture = GFX_event_solarempire

  fire_only_once = yes

  trigger = {
    tag = SOL
    has_completed_focus = SOL_rehabilitate
    NOT = { country_exists = EQS }
    NOT = { has_country_flag = SOL_EQS_generals_rehabilitated }
    OR = {
      NOT = { has_unit_leader = 20 }
      NOT = { has_unit_leader = 30 }
      NOT = { has_unit_leader = 40 }
      NOT = { has_unit_leader = 60 }
    }
  }

  mean_time_to_happen = {
    days = 20
  }

  option = { #very well
    name = solarempire.9.a
    if = {
      limit = { NOT = { has_unit_leader = 20 } }
      create_corps_commander = {
        name = "Soarin"
        portrait_path = "gfx/leaders/EQS/Soarin.tga"
        traits = { air_force_commander  }
        skill = 3
        id = 20
      }
    }
    if = {
      limit = { NOT = { has_unit_leader = 30 } }
      create_corps_commander = {
        name = "FastClip"
        portrait_path = "gfx/leaders/EQS/FastClip.tga"
        traits = { trait_engineer  }
        skill = 2
        id = 30
      }
    }
    if = {
      limit = { NOT = { has_unit_leader = 40 } }
      create_corps_commander = {
        name = "Whiplash"
        portrait_path = "gfx/leaders/EQS/Whiplash.tga"
        traits = { old_guard  }
        skill = 2
        id = 40
      }
    }
    if = {
      limit = { NOT = { has_unit_leader = 60 } }
      create_corps_commander = {
        name = "Surprise"
        portrait_path = "gfx/leaders/EQS/Surprise.dds"
         traits = {  }
        skill = 2
        id = 60
      }
    }
    hidden_effect = { set_country_flag = SOL_EQS_generals_rehabilitated }
  }
}

#Purge
country_event = {
  id = solarempire.10
  title = solarempire.10.t
  desc = {
    text = solarempire.10.d_inq
    trigger = {
      has_completed_focus = SOL_god_empress
    }
  }
  desc = {
    text = solarempire.10.d
    trigger = {
     NOT = {
      has_completed_focus = SOL_god_empress
     }
    }
  }
  picture = GFX_event_solarempire

  fire_only_once = yes

  is_triggered_only = yes

  immediate = {
    hidden_effect = { set_country_flag = SOL_purge_finished }
  }

  option = { #very well
    name = solarempire.10.a
    trigger = {
      has_unit_leader = 20
    }
    if = {
      limit = { has_unit_leader = 10000 }
      remove_unit_leader = 10000
    }
    remove_unit_leader = 20
  }
  option = { #very well
    name = solarempire.10.b
    trigger = {
      has_unit_leader = 30
    }
    if = {
      limit = { has_unit_leader = 10000 }
      remove_unit_leader = 10000
    }
    remove_unit_leader = 30
  }
  option = { #very well
    name = solarempire.10.c
    trigger = {
      has_unit_leader = 40
    }
    if = {
      limit = { has_unit_leader = 10000 }
      remove_unit_leader = 10000
    }
    remove_unit_leader = 40
  }
}

#New Generals
country_event = {
  id = solarempire.11
  title = solarempire.11.t
  desc = solarempire.11.d
  picture = GFX_event_solarempire

  fire_only_once = yes

  is_triggered_only = yes

  option = { #Needs portraits!
    name = solarempire.11.a
    create_field_marshal = {
      name = "Sunset Shimmer"
      portrait_path = "gfx/leaders/SOL/SunsetShimmer.dds"
       traits = { organisational_leader fast_planner }
      skill = 3
      #id = 16
    }
    if = {
      limit = { NOT = { has_unit_leader = 110 } }
      create_corps_commander = {
        name = "Kaiserslautern"
        portrait_path = "gfx/leaders/EQS/mageytash.tga"
         traits = { }
        skill = 2
        id = 110
      }
    }
    if = {
      limit = { NOT = { has_unit_leader = 60 } }
      SOL = {
        create_corps_commander = {
          name = "Surprise"
          portrait_path = "gfx/leaders/EQS/Surprise.dds"
           traits = {  }
          skill = 2
          id = 60
        }
      }
    }
    create_corps_commander = {
      name = "Capsaicin"
      portrait_path = "gfx/leaders/SOL/Spice.tga"
       traits = { urban_assault_specialist }
      skill = 3
      #id = 17
    }
    create_corps_commander = {
      name = "Comm Rush"
      portrait_path = "gfx/leaders/SOL/Comm Rush.tga"
       traits = {  }
      skill = 2
      #id = 18
    }
}
}

country_event = {
  id = solarempire.12
  title = solarempire.12.t
  desc = solarempire.12.d
  picture = GFX_event_solarempire

  mean_time_to_happen = {
    days = 5
  }

  trigger = {
    NOT = { eqs_has_civil_war = yes }
    SOL = { has_completed_focus = SOL_end_of_civil_war }
    country_exists = SOL
    SOL = { is_subject = no }
    has_country_flag = former_EQS_puppet
    OR = {
      has_country_flag = former_integrated_puppet
      has_country_flag = former_puppet
      has_country_flag = former_colony
      has_country_flag = former_dominion
    }
    NOT = { original_tag = CRY }
  }

  immediate = {
    hidden_effect = { clr_country_flag = former_EQS_puppet }
  }

  option = {
    name = solarempire.12.a
    SOL = { puppet = ROOT }
    set_previous_autonomy_level = yes
    ai_chance = {
      factor = 1
      modifier = {
        factor = 0.1
        strength_ratio = { tag = SOL ratio > 0.8 }
      }
    }
  }
  option = {
    name = solarempire.12.b
    SOL = {
      create_wargoal = {
          target = ROOT type = puppet_wargoal_focus
      }
    }
    ai_chance = {
      factor = 0.2
    }
  }
}

country_event = {
    id = solarempire.13
    title = solarempire.13.t
    desc = solarempire.13.d
    picture = GFX_event_solarempire

    is_triggered_only = yes
    fire_only_once = yes
    option = {
        name = solarempire.13.a
        custom_effect_tooltip = available_political_advisor
        show_ideas_tooltip = evil_twilight_sparkle
        hidden_effect = { set_global_flag = SOL_twilight_converted }
    }
}

country_event = {
  id = solarempire.14
  title = solarempire.14.t
  desc = solarempire.14.d
  picture = GFX_event_solarempire

  is_triggered_only = yes

  option = { #Stay neutral
    name = solarempire.14.a
    end_puppet_this = yes
    if = {
      limit = { is_in_faction_with = EQS }
      EQS = { remove_from_faction = ROOT }
    }
    reverse_add_opinion_modifier = { target = SOL modifier = cry_betrayal }
    hidden_effect = {
      if = {
        limit = { has_war_with = SOL }
        white_peace = SOL
      }
    }
    ai_chance = {
      factor = 2
      modifier = {
        factor = 3
        original_tag = CRY
      }
      modifier = {
        NOT = {
          is_neighbor_of = EQS
          is_neighbor_of = SOL
        }
        factor = 1.5
      }
    }
  }
  option = { #Support Daybreaker
    name = solarempire.14.b
    if = {
      limit = { is_subject_of = EQS }
      get_current_autonomy_level = yes
      set_country_flag = former_EQS_puppet
      overlord = { end_puppet = ROOT }
    }
    if = {
      limit = { is_in_faction_with = EQS }
      EQS = { remove_from_faction = ROOT }
    }
    hidden_effect = {
      if = {
        limit = { has_war_with = SOL }
        white_peace = SOL
      }
    }
    add_popularity = { ideology = democratic popularity = -0.1 }
    effect_tooltip = {
      add_to_war = {
        targeted_alliance = SOL enemy = NLR
      }
    }
    hidden_effect = {
      country_event = { id = equestria.160 days = 1 }
    }
    ai_chance = {
      factor = 2
      modifier = {
        factor = 1.5
        NOT = { original_tag = CRY }
      }
      modifier = {
        factor = 10
        has_government = fascism
      }
      modifier = {
        factor = 2
        has_autonomy_state = autonomy_integrated_puppet
      }
      modifier = {
        factor = 1.5
        has_autonomy_state = autonomy_puppet
      }
    }
  }
  option = { #Support NMM
    name = solarempire.14.c
    if = {
      limit = { is_subject_of = EQS }
      get_current_autonomy_level = yes
      set_country_flag = former_EQS_puppet
      overlord = { end_puppet = ROOT }
    }
    if = {
      limit = { is_in_faction_with = EQS }
      EQS = { remove_from_faction = ROOT }
    }
    hidden_effect = {
      if = {
        limit = { has_war_with = NLR }
        white_peace = NLR
      }
    }
    add_popularity = { ideology = democratic popularity = -0.1 }
    effect_tooltip = {
      add_to_war = {
        targeted_alliance = NLR enemy = SOL
      }
    }
    hidden_effect = {
      country_event = { id = equestria.163 days = 1 }
    }
    ai_chance = {
      factor = 0.5 #ya gotta be kidding
    }
  }
}

country_event = {
  id = solarempire.15
  title = solarempire.15.t
  desc = solarempire.15.d
  picture = GFX_event_solarempire

  trigger = {
    original_tag = CRY
    has_global_flag = SOL_wartime_change
    SOL = { has_war = no }
    is_subject_of = SOL
    NOT = {
      has_government = fascism
      SOL = { has_completed_focus = SOL_Crystal_Fair }
      has_country_flag = SOL_CRY_didnt_break_free
    }
  }

  mean_time_to_happen = { days = 30 }

  option = { #Break free
    name = solarempire.15.a
    end_puppet_this = yes
    if = {
      limit = { is_in_faction_with = SOL }
      SOL = { remove_from_faction = ROOT }
    }
    reverse_add_opinion_modifier = { target = SOL modifier = cry_betrayal }
    SOL = {
      create_wargoal = {
          target = ROOT type = puppet_wargoal_focus
      }
    }
    ai_chance = {
      factor = 2
      modifier = {
        factor = 4
        original_tag = CRY
      }
      modifier = {
        NOT = {
          is_neighbor_of = EQS
          is_neighbor_of = SOL
        }
        factor = 1.5
      }
    }
  }
  option = { #Status quo
    name = solarempire.15.b

    ai_chance = {
      factor = 3
      modifier = {
        factor = 10
        has_government = fascism
      }
      modifier = {
        factor = 4
        has_autonomy_state = autonomy_integrated_puppet
        NOT = { original_tag = CRY }
      }
      modifier = {
        factor = 2
        has_autonomy_state = autonomy_puppet
        NOT = { original_tag = CRY }
      }
    }
  }
}

country_event = {
  id = solarempire.16
  hidden = yes

  trigger = {
    SOL = {
      exists = yes
      has_completed_focus = SOL_Imperium_Solis
      has_country_leader = { ruling_only = yes name = "Daybreaker" }
    }
    has_war_with = SOL
    NOT = { has_idea = SOL_enemy_debuff_idea }
  }

  mean_time_to_happen = { days = 7 }

  immediate = {
    add_ideas = SOL_enemy_debuff_idea
  }

  option = {
  }
}

#Twiggles thinks of running away
country_event = {
  id = solarempire.17
  hidden = yes

  fire_only_once = yes
  is_triggered_only = yes

  immediate = {
    random_list = {
      30 = {
        country_event = solarempire.18
      }
      70 = {
        set_country_flag = SOL_has_twilight
        country_event = solarempire.19
      }
    }
  }

  option = {
  }
}

country_event = { # Changeling Puppet
    id = solarempire.906
    title = solarempire.902.t
    desc = solarempire.902.d
    picture = GFX_event_canterlot

    trigger = {
        original_tag = CHN
        is_subject = yes
        has_government = fascism
        NOT = { has_country_flag = chn_is_fascist_puppet }
    }
    mean_time_to_happen = { days = 1 }
    option = {
        name = solarempire.902.a
        hidden_effect = {
          set_country_flag = chn_is_fascist_puppet
          set_party_name = { ideology = fascism long_name = CHN_fascism_puppet_party name = CHN_fascism_puppet_party }
          create_country_leader = {
          	name = "Changeling King"
          	expire = "1965.1.1"
          	ideology = fascism_ideology
          	picture = "Default.tga"
          	traits = {
          	}
          }
        }
    }
}
country_event = { # Removal of cosmetic
    id = solarempire.910
    title = solarempire.910.t
    desc = solarempire.910.d
    picture = GFX_event_canterlot

    trigger = {
        has_country_flag = chn_is_fascist_puppet
        is_subject = no
    }
    mean_time_to_happen = { days = 1 }
    option = {
        name = solarempire.910.a
        clr_country_flag = chn_is_fascist_puppet
        set_party_name = { ideology = fascism long_name = CHN_fascism_party name = CHN_fascism_party }
        hidden_effect = {
          if = {
            limit = { has_completed_focus = Chrysalis }
          create_country_leader = {
          	name = "Queen Chrysalis"
          	expire = "1965.1.1"
          	picture = "Chrysalis.tga"
           ideology = nazism
           desc = "POLITICS_CHRYSALIS_DESC"
          	traits = {
          		warmonger changeling_queen
          	}
            }
            else = {
            create_country_leader = {
              name = "Queen Chrysalis"
              expire = "1965.1.1"
              picture = "Chrysalis.tga"
             ideology = nazism
             desc = "POLITICS_CHRYSALIS_DESC"
              traits = {
                warmonger
              }
              }
            }
          }
        }
    }
}

country_event = { # debug
    id = solarempire.911
    title = solarempire.911.t
    desc = solarempire.911.d
    picture = GFX_event_canterlot

    is_triggered_only = yes
    trigger = {
      has_global_flag = EQS_evil_celestia
    }
    option = {
        name = solarempire.910.a
        set_global_flag = EQS_evil_celestia
    }
}

country_event = {
  id = solarempiresparkles.1
  title = solarempiresparkles.1.t
  desc = solarempiresparkles.1.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  immediate = {
    hidden_effect = {
      random_country = {
        limit = { original_tag = CRY has_country_leader = { name = "Princess Mi Amore Cadenza" ruling_only = yes } }
        save_event_target_as = CRY_cadence
      }
    }
  }

  #Lunar rebel deception
  option = {
    name = solarempiresparkles.1.a
    custom_effect_tooltip = solarempiresparkles.1.a.tp
    hidden_effect = {
      country_event = { id = solarempiresparkles.2 days = 2 }
    }
    ai_chance = {
      factor = 1
      modifier = {
        factor = 2
        has_completed_focus = SOL_empress_mother
      }
    }
  }
  #Negotiate
  option = {
    name = solarempiresparkles.1.b
    custom_effect_tooltip = solarempiresparkles.1.b.tp
    hidden_effect = {
    }
    ai_chance = {
      factor = 1
      modifier = {
        factor = 2
        has_completed_focus = SOL_empress_protector
      }
    }
  }
  #Demand
  option = {
    name = solarempiresparkles.1.c
    custom_effect_tooltip = solarempiresparkles.1.c.tp
    hidden_effect = {
    }
    ai_chance = {
      factor = 1
      modifier = {
        factor = 2
        has_completed_focus = SOL_god_empress
      }
      modifier = {
        factor = 0
        NOT = { has_completed_focus = SOL_god_empress }
      }
    }
  }
}

country_event = {
  id = solarempiresparkles.2
  title = solarempiresparkles.2.t
  desc = solarempiresparkles.2.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  immediate = {
    hidden_effect = {
      event_target:CRY_cadence = {
        country_event = solarempiresparkles.3
      }
    }
  }

  option = {
    name = solarempiresparkles.2.a
    #custom_effect_tooltip = solarempiresparkles.2.a.tp
    hidden_effect = {
      random_list = {
        70 = {
          set_country_flag = { flag = CRY_sparkle_suspicion value = 0 }
        }
        30 = {
          set_country_flag = { flag = CRY_sparkle_suspicion value = 1 }
        }
      }
      country_event = { id = solarempiresparkles.4 days = 1 }
    }
  }
}

#For CRY
country_event = {
  id = solarempiresparkles.3
  title = solarempiresparkles.3.t
  desc = solarempiresparkles.3.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempiresparkles.3.a
    add_political_power = 20
    add_popularity = { ideology = democratic popularity = 0.05 }
  }
}

country_event = {
  id = solarempiresparkles.4
  title = solarempiresparkles.4.t
  desc = {
    text = solarempiresparkles.4.d
    trigger = {
      has_country_flag = { flag = CRY_sparkle_suspicion value < 1 }
    }
  }
  desc = {
    text = solarempiresparkles.4.d_susp
    trigger = {
     has_country_flag = { flag = CRY_sparkle_suspicion value > 0 }
    }
  }
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempiresparkles.4.a
    #effect_tooltip = solarempiresparkles.4.a.tp
    hidden_effect = {
      country_event = { id = solarempiresparkles.41 hours = 8 }
    }
  }
}

country_event = {
  id = solarempiresparkles.41
  title = solarempiresparkles.41.t
  desc = {
    text = solarempiresparkles.41.d
    trigger = {
      has_country_flag = { flag = CRY_sparkle_suspicion value < 1 }
    }
  }
  desc = {
    text = solarempiresparkles.41.d_susp
    trigger = {
     has_country_flag = { flag = CRY_sparkle_suspicion value > 0 }
    }
  }
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempiresparkles.41.a
    hidden_effect = {
      country_event = { id = solarempiresparkles.5 days = 4 }
    }
  }
}

country_event = {
  id = solarempiresparkles.5
  title = solarempiresparkles.5.t
  desc = solarempiresparkles.5.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempiresparkles.5.a
    #custom_effect_tooltip = solarempiresparkles.5.a.tp
    hidden_effect = {
      random_list = {
        80 = {
          country_event = { id = solarempiresparkles.15 days = 1 }
        }
        15 = {
          modify_country_flag = { flag = CRY_sparkle_suspicion value = 1 }
          country_event = { id = solarempiresparkles.15 days = 1 }
        }
        5 = {
          country_event = { id = solarempiresparkles.6 hours = 1 }
          event_target:CRY_cadence = { country_event = { id = solarempiresparkles.7 hours = 6 } }
        }
      }
    }
  }
}

country_event = {
  id = solarempiresparkles.6
  title = solarempiresparkles.6.t
  desc = solarempiresparkles.6.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempiresparkles.6.a
  }
}

country_event = {
  id = solarempiresparkles.7
  title = solarempiresparkles.7.t
  desc = solarempiresparkles.7.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes


  option = {
    name = solarempiresparkles.7.a
    add_opinion_modifier = { target = SOL modifier = cry_betrayal }
    hidden_effect = {
      set_country_flag = SOL_twilight_captured
      SOL = {
        set_country_flag = SOL_twilight_unavailable
        country_event = solarempiresparkles.8
      }
    }
  }
  option = {
    name = solarempiresparkles.7.b
    add_opinion_modifier = { target = SOL modifier = cry_betrayal }
    hidden_effect = {
      SOL = {
        country_event = solarempiresparkles.9
      }
    }
  }
}

country_event = {
  id = solarempiresparkles.8
  title = solarempiresparkles.8.t
  desc = solarempiresparkles.8.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempiresparkles.8.a
    add_political_power = -20
    effect_tooltip = { reverse_add_opinion_modifier = { target = event_target:CRY_cadence modifier = cry_betrayal } }
  }
  option = {
    name = solarempiresparkles.8.b #negotiate ransom
    add_political_power = -100
    effect_tooltip = { reverse_add_opinion_modifier = { target = event_target:CRY_cadence modifier = cry_betrayal } }
    FROM = { country_event = { id = solarempiresparkles.10 days = 1 } }
  }
}

country_event = {
  id = solarempiresparkles.10
  title = solarempiresparkles.10.t
  desc = solarempiresparkles.10.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = { #Agree for non-agression and guarantee
    name = solarempiresparkles.10.a
    add_political_power = -20
    FROM = { country_event = { id = solarempiresparkles.12 days = 1 } }
  }
  option = { #Decline
    name = solarempiresparkles.10.b
    add_political_power = 20
    FROM = {
      add_opinion_modifier = { target = ROOT modifier = cry_refused_to_negotiate }
      country_event = { id = solarempiresparkles.11 days = 1 }
    }
  }
}

country_event = {
  id = solarempiresparkles.11
  title = solarempiresparkles.11.t
  desc = solarempiresparkles.11.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = { #
    name = solarempiresparkles.11.a
    add_political_power = -20
  }
}

country_event = {
  id = solarempiresparkles.12
  title = solarempiresparkles.12.t
  desc = solarempiresparkles.12.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = { #Agree for non-agression and guarantee
    name = solarempiresparkles.12.a
    add_political_power = -200
    custom_effect_tooltip = solarempiresparkles.12.a.tp
    diplomatic_relation = { country = FROM relation = non_aggression_pact }
    give_guarantee = FROM
    FROM = { country_event = { id = solarempiresparkles.14 days = 1 } }
    hidden_effect = {
      clr_country_flag = SOL_twilight_unavailable
      FROM = {
        clr_country_flag = SOL_twilight_captured
      }
    }
  }
  option = { #Decline
    name = solarempiresparkles.12.b
    add_political_power = 20
    FROM = { country_event = { id = solarempiresparkles.13 days = 1 } }
  }
}

country_event = {
  id = solarempiresparkles.14
  title = solarempiresparkles.14.t
  desc = solarempiresparkles.14.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = { #Agree for non-agression and guarantee
    name = solarempiresparkles.14.a
    FROM = {
      custom_effect_tooltip = solarempiresparkles.12.a.tp
      effect_tooltip = {
        diplomatic_relation = { country = ROOT relation = non_aggression_pact }
        give_guarantee = ROOT
      }
    }
  }
}

country_event = {
  id = solarempiresparkles.15
  title = solarempiresparkles.15.t
  desc = {
    text = solarempiresparkles.15.d_susp
    trigger = {
      has_country_flag = { flag = CRY_sparkle_suspicion value > 1 }
    }
  }
  desc = {
    text = solarempiresparkles.15.d
    trigger = {
     has_country_flag = { flag = CRY_sparkle_suspicion value > 0 }
     has_country_flag = { flag = CRY_sparkle_suspicion value < 2 }
    }
  }
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempiresparkles.15.a
    #custom_effect_tooltip = solarempiresparkles.15.a.tp
    hidden_effect = {
      country_event = {id = solarempiresparkles.150 hours = 1}
    }
  }
}

country_event = {
  id = solarempiresparkles.150
  title = solarempiresparkles.150.t
  desc = solarempiresparkles.150.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempiresparkles.150.a
    hidden_effect = {
      if = {
        limit = {
          has_country_flag = { flag = CRY_sparkle_suspicion value > 1 }
        }
        random_list = {
          65 = {
            country_event = { id = solarempiresparkles.16 hours = 6 }
            event_target:CRY_cadence = { country_event = { id = solarempiresparkles.20 hours = 12 } }
          }
          35 = {
            country_event = { id = solarempiresparkles.17 days = 1 }
          }
        }
        else = {
          if = {
            limit = {
              has_country_flag = { flag = CRY_sparkle_suspicion value > 0 }
            }
            random_list = {
              77 = {
                country_event = { id = solarempiresparkles.16 hours = 6 }
                event_target:CRY_cadence = { country_event = { id = solarempiresparkles.20 hours = 12 } }
              }
              23 = {
                country_event = { id = solarempiresparkles.17 days = 1 }
              }
            }
            else = {
            random_list = {
                85 = {
                  country_event = { id = solarempiresparkles.16 hours = 6 }
                  event_target:CRY_cadence = { country_event = { id = solarempiresparkles.20 hours = 12 } }
                }
                15 = {
                  country_event = { id = solarempiresparkles.17 days = 1 }
                }
              }
            }
          }
        }
      }
    }
  }
}

country_event = {
  id = solarempiresparkles.17
  title = solarempiresparkles.17.t
  desc = solarempiresparkles.17.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempiresparkles.17.a
    #custom_effect_tooltip = solarempiresparkles.15.a.tp
    hidden_effect = {
      random_list = {
        70 = {
          event_target:CRY_cadence = { country_event = { id = solarempiresparkles.19 hours = 2 } }
        }
        30 = {
          event_target:CRY_cadence = { country_event = { id = solarempiresparkles.7 hours = 2 } }
          set_country_flag = SOL_sparkles_didnt_make_it
        }
      }
      country_event = { id = solarempiresparkles.18 }
    }
  }
}

country_event = {
  id = solarempiresparkles.18
  title = {
    text = solarempiresparkles.18.t_fail
    trigger = {
      has_country_flag = SOL_sparkles_didnt_make_it
    }
  }
  title = {
    text = solarempiresparkles.18.t
    trigger = {
      NOT = { has_country_flag = SOL_sparkles_didnt_make_it }
    }
  }
  desc = {
    text = solarempiresparkles.18.d_fail
    trigger = {
      has_country_flag = SOL_sparkles_didnt_make_it
    }
  }
  desc = {
    text = solarempiresparkles.18.d_susp
    trigger = {
      NOT = { has_country_flag = SOL_sparkles_didnt_make_it }
    }
  }
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempiresparkles.18.a
    effect_tooltip = { reverse_add_opinion_modifier = { target = event_target:CRY_cadence modifier = cry_betrayal } }
    trigger = {
      NOT = { has_country_flag = SOL_sparkles_didnt_make_it }
    }
  }
  option = {
    name = solarempiresparkles.18.b
    effect_tooltip = { reverse_add_opinion_modifier = { target = event_target:CRY_cadence modifier = cry_betrayal } }
    trigger = {
      has_country_flag = SOL_sparkles_didnt_make_it
    }
  }
}

country_event = {
  id = solarempiresparkles.19
  title = solarempiresparkles.19.t
  desc = solarempiresparkles.19.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = { #
    name = solarempiresparkles.19.a
    add_opinion_modifier = { target = SOL modifier = cry_betrayal }
  }
}

country_event = {
  id = solarempiresparkles.16
  title = solarempiresparkles.16.t
  desc = solarempiresparkles.16.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = { #
    name = solarempiresparkles.16.a
    country_event = { id = solarempiresparkles.21 hours = 6 }
    effect_tooltip = { event_target:CRY_cadence = { reverse_add_opinion_modifier = { target = SOL modifier = cry_betrayal } } }
  }
}

country_event = {
  id = solarempiresparkles.20
  title = solarempiresparkles.20.t
  desc = solarempiresparkles.20.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = { #
    name = solarempiresparkles.20.a
    add_political_power = -200
    if = {
      limit = { has_idea = royal_family3 }
      swap_ideas = { remove_idea = royal_family3 add_idea = royal_family2 }
    }
    if = {
      limit = { has_idea = royal_family2 }
      swap_ideas = { remove_idea = royal_family2 add_idea = royal_family }
    }
    add_ideas = flurryheart_imprisioned
    add_opinion_modifier = { target = SOL modifier = cry_betrayal }
  }
}

country_event = {
  id = solarempiresparkles.21
  title = solarempiresparkles.21.t
  desc = solarempiresparkles.21.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = { #
    name = solarempiresparkles.21.a
    add_political_power = 150
    event_target:CRY_cadence = { country_event = { id = solarempiresparkles.22 days = 1 } }
  }
}

country_event = {
  id = solarempiresparkles.22
  title = solarempiresparkles.22.t
  desc = solarempiresparkles.22.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = { #
    name = solarempiresparkles.22.a
    FROM = {
      hidden_effect = { get_current_government_type = yes }
      puppet = ROOT
      hidden_effect = { restore_previous_government_type = yes }
    }
    hidden_effect = {
      swap_ideas = { remove_idea = flurryheart_imprisioned add_idea = flurryheart_imprisioned1 }
      add_autonomy_ratio = { value = -0.15 }
    }
    FROM = { country_event = { id = solarempiresparkles.23 days = 1 } }
    ai_chance = {
      factor = 100
    }
  }
  option = { #
    name = solarempiresparkles.22.b
    add_political_power = -750
    add_national_unity = -0.20
    FROM = { country_event = { id = solarempiresparkles.23 days = 1 } }
    ai_chance = {
      factor = 1
    }
  }
}

country_event = {
  id = solarempiresparkles.23
  title = solarempiresparkles.23.t
  desc = {
    text = solarempiresparkles.23.d_agree
    trigger = {
      FROM = { is_subject_of = ROOT }
    }
  }
  desc = {
    text = solarempiresparkles.23.d_noagree
    trigger = {
      FROM = { NOT = { is_subject_of = ROOT } }
    }
  }
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempiresparkles.23.a
  }
}

#Negotiations

#SOL
country_event = {
  id = solarempiresparkles.24
  title = solarempiresparkles.24.t
  desc = solarempiresparkles.24.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempiresparkles.25.a
    event_target:CRY_cadence = {
      country_event = { id = solarempiresparkles.25 hours = 1 }
    }
   }
}

#CRY
country_event = {
  id = solarempiresparkles.25
  title = solarempiresparkles.25.t
  desc = solarempiresparkles.25.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = { #Agree to negotiate
    name = solarempiresparkles.25.a
    FROM = {
      country_event = { id = solarempiresparkles.27 hours = 3 }
    }
   }
  option = { #Decline to negotiate
    name = solarempiresparkles.25.b
    add_political_power = 100
    FROM = {
      add_opinion_modifier = { target = ROOT modifier = cry_refused_to_negotiate }
      add_opinion_modifier = { target = ROOT modifier = hostility }
      country_event = { id = solarempiresparkles.26 hours = 3 }
    }
  }
}

#SOL
#Cadence refuses
country_event = {
  id = solarempiresparkles.26
  title = solarempiresparkles.26.t
  desc = solarempiresparkles.26.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempiresparkles.26.a
    add_political_power = -40
    effect_tooltip = {
      add_opinion_modifier = { target = FROM modifier = cry_refused_to_negotiate }
      add_opinion_modifier = { target = FROM modifier = hostility }
    }
  }
}

#SOL
#Cadence agrees
country_event = {
  id = solarempiresparkles.27
  title = solarempiresparkles.27.t
  desc = solarempiresparkles.27.d
  picture = GFX_event_solarempire

  #fire_only_once = yes

  is_triggered_only = yes

  option = {
    name = solarempiresparkles.27.a
    add_political_power = -40
    effect_tooltip = { add_opinion_modifier = { target = FROM modifier = cry_refused_to_negotiate } }
  }
}

#Sparkle breaks out of prison
country_event = {
  id = solarempiresparkles.100
  title = solarempiresparkles.100.t
  desc = solarempiresparkles.100.d
  picture = GFX_event_solarempire

  fire_only_once = yes

  trigger = {

    has_country_flag = SOL_twilight_unavailable
    OR = {
      controls_state = 344
      any_allied_country = {
        controls_state = 344
      }
      any_country = {
        is_subject_of = ROOT
        controls_state = 344
      }
      any_country = {
        has_country_flag = SOL_twilight_captured
        OR = {
          has_civil_war = yes
          has_capitulated = yes
        }
      }
    }
	}

  mean_time_to_happen = {
    days = 1
  }

  option = {
    name = solarempiresparkles.100.a
    clr_country_flag = SOL_twilight_unavailable
    hidden_effect = {
      random_country = {
        limit = { has_country_flag = SOL_twilight_captured }
        clr_country_flag = SOL_twilight_captured
      }
    }
  }
}

#Flurry Heart rescued
country_event = {
  id = solarempiresparkles.101
  title = solarempiresparkles.101.t
  desc = solarempiresparkles.101.d
  picture = GFX_event_solarempire

  fire_only_once = yes

  trigger = {

    OR = {
      has_idea = flurryheart_imprisioned
      has_idea = flurryheart_imprisioned1
    }
    OR = {
      controls_state = 3
      any_allied_country = {
        controls_state = 3
      }
      AND = {
        has_war_with = SOL
        SOL = { has_capitulated = yes }
      }
    }
	}

  mean_time_to_happen = {
    days = 1
  }

  option = {
    name = solarempiresparkles.101.a
    remove_ideas = flurryheart_imprisioned
    remove_ideas = flurryheart_imprisioned1
    if = {
      limit = { has_idea = royal_family2 }
      swap_ideas = { remove_idea = royal_family2 add_idea = royal_family3 }
    }
    if = {
      limit = { has_idea = royal_family }
      swap_ideas = { remove_idea = royal_family add_idea = royal_family2 }
    }
  }
}
