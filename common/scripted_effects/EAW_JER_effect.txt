@PARLIAMENT_SEATS = 400

update_JER_parliament_max = {
	set_temp_variable = { JER.communist_max_old = JER.communist_max }
	set_temp_variable = { JER.democratic_max_old = JER.democratic_max }
	set_temp_variable = { JER.fascist_max_old = JER.fascist_max }
	set_temp_variable = { JER.neutrality_max_old = JER.neutrality_max }

	set_variable = { JER.communist_max = party_popularity@communism }
	set_variable = { JER.democratic_max = party_popularity@democratic }
	set_variable = { JER.fascist_max = party_popularity@fascism }
	set_variable = { JER.neutrality_max = party_popularity@neutrality }

	multiply_variable = { JER.communist_max = @PARLIAMENT_SEATS }
	multiply_variable = { JER.democratic_max = @PARLIAMENT_SEATS }
	multiply_variable = { JER.fascist_max = @PARLIAMENT_SEATS }
	multiply_variable = { JER.neutrality_max = @PARLIAMENT_SEATS }

	round_variable = JER.communist_max
	round_variable = JER.democratic_max
	round_variable = JER.fascist_max
	round_variable = JER.neutrality_max

	set_temp_variable = { JER.max_check = JER.communist_max }
	add_to_temp_variable = { JER.max_check = JER.democratic_max }
	add_to_temp_variable = { JER.max_check = JER.fascist_max }
	add_to_temp_variable = { JER.max_check = JER.neutrality_max }

	if = {
		limit = { check_variable = { JER.max_check < @PARLIAMENT_SEATS } }
		if = {
			limit = {
				check_variable = { var = JER.communist_max value = JER.democratic_max compare = greater_than_or_equals }
				check_variable = { var = JER.communist_max value = JER.fascist_max compare = greater_than_or_equals }
				check_variable = { var = JER.communist_max value = JER.neutrality_max compare = greater_than_or_equals }
			}
			add_to_variable = { JER.communist_max = 1 }
		}
		else_if = {
			limit = {
				check_variable = { var = JER.democratic_max value = JER.communist_max compare = greater_than_or_equals }
				check_variable = { var = JER.democratic_max value = JER.fascist_max compare = greater_than_or_equals }
				check_variable = { var = JER.democratic_max value = JER.neutrality_max compare = greater_than_or_equals }
			}
			add_to_variable = { JER.democratic_max = 1 }
		}
		else_if = {
			limit = {
				check_variable = { var = JER.fascist_max value = JER.communist_max compare = greater_than_or_equals }
				check_variable = { var = JER.fascist_max value = JER.democratic_max compare = greater_than_or_equals }
				check_variable = { var = JER.fascist_max value = JER.neutrality_max compare = greater_than_or_equals }
			}
			add_to_variable = { JER.fascist_max = 1 }
		}
		else = {
			add_to_variable = { JER.neutrality_max = 1 }
		}
	}

	set_temp_variable = { JER.communist_max_diff = JER.communist_max }
	set_temp_variable = { JER.democratic_max_diff = JER.democratic_max }
	set_temp_variable = { JER.fascist_max_diff = JER.fascist_max }
	set_temp_variable = { JER.neutrality_max_diff = JER.neutrality_max }

	subtract_from_temp_variable = { JER.communist_max_diff = JER.communist_max_old }
	subtract_from_temp_variable = { JER.democratic_max_diff = JER.democratic_max_old }
	subtract_from_temp_variable = { JER.fascist_max_diff = JER.fascist_max_old }
	subtract_from_temp_variable = { JER.neutrality_max_diff = JER.neutrality_max_old }

	if = {
		limit = { NOT = { has_variable = JER.communist_support } }
		set_variable = { JER.communist_support = 0 }
		set_variable = { JER.democratic_support = 0 }
		set_variable = { JER.fascist_support = 0 }
		set_variable = { JER.neutrality_support = 0 }
	}

	clamp_variable = { var = JER.communist_support min = 0 max = JER.communist_max }
	clamp_variable = { var = JER.democratic_support min = 0 max = JER.democratic_max }
	clamp_variable = { var = JER.fascist_support min = 0 max = JER.fascist_max }
	clamp_variable = { var = JER.neutrality_support min = 0 max = JER.neutrality_max }

	set_variable = { JER.parliament_max = JER.communist_support }
	add_to_variable = { JER.parliament_max = JER.democratic_support }
	add_to_variable = { JER.parliament_max = JER.fascist_support }
	add_to_variable = { JER.parliament_max = JER.neutrality_support }
}