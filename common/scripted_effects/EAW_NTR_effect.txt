population_calculator_multifunctional = {
	if = {
		limit = {
			check_variable = { population_var > 0 } # check for overflow
		}
		
		divide_variable = { population_var = ROOT.divider }
		
		#print_variables = {
		#	file = check_effect
		#	text = Population_pre
		#	append = yes
		#	var_list = {
		#		population_var
		#		ROOT.divider
		#		ROOT.randomizer
		#		ROOT.rounder
		#	}
		#}
		
		set_temp_variable = { population_variation_temp_var = population_var }
		multiply_temp_variable = { population_variation_temp_var = ROOT.randomizer }
		multiply_temp_variable = { population_variation_temp_var = random }
		
		random_list = {
			50 = {
				multiply_temp_variable = { population_variation_temp_var = -1 }
			}
			50 = {
				# nothing
			}
		}
		
		add_to_variable = { population_var = population_variation_temp_var }
		
		divide_variable = { population_var = ROOT.rounder }
		round_variable = population_var
		multiply_variable = { population_var = ROOT.rounder }
		
		#print_variables = {
		#	file = check_effect
		#	text = Population_post
		#	append = yes
		#	var_list = {
		#		population_var
		#		population_variation_temp_var
		#	}
		#}
	}
	else = {
		set_variable = { population_var = state_population_k }
		multiply_variable = { population_var = ROOT.divider }
		
		set_temp_variable = { population_variation_temp_var = population_var }
		multiply_temp_variable = { population_variation_temp_var = ROOT.randomizer }
		multiply_temp_variable = { population_variation_temp_var = random }
		
		random_list = {
			50 = {
				multiply_temp_variable = { population_variation_temp_var = -1 }
			}
			50 = {
				# nothing
			}
		}
		
		add_to_variable = { population_var = population_variation_temp_var }
		multiply_variable = { population_var = 1000 }
	}
}

population_calculator_multifunctional_k = {
	multiply_variable = { population_k = ROOT.divider }
	
	set_temp_variable = { population_k_variation_temp_var = population_k }
	multiply_temp_variable = { population_k_variation_temp_var = ROOT.randomizer }
	
	set_temp_variable = { population_k_variation_temp_var = random }
	multiply_temp_variable = { population_k_variation_temp_var = random }
	
	random_list = {
		50 = {
			multiply_temp_variable = { population_k_variation_temp_var = -1 }
		}
		50 = {
			# nothing
		}
	}
	
	add_to_variable = { population_k = population_k_variation_temp_var }
}

population_calculator_cleaner = {
	clear_variable = divider
	clear_variable = randomizer
	clear_variable = rounder
}

population_calculator_cleaner_k = {
	clear_variable = divider
	clear_variable = randomizer
}

population_clr_junk = {
	clear_variable = population_var
	clear_variable = population_sum
}

population_calculation_for_sum = {
	add_to_variable = { ROOT.population_sum = population_var }
	
	add_manpower = population_var
	
	#print_variables = {
	#	file = check_effect
	#	text = Population_post
	#	append = yes
	#	print_global = yes
	#	var_list = {
	#		population_var
	#		ROOT.population_sum
	#	}
	#}
}

population_calculation_for_sum_k = {
	add_to_variable = { ROOT.population_sum_k = population_k }
	
	multiply_variable = { population_k = 1000 }
	add_manpower = population_k
}

increase_population_multifunctional_preset = {
	multiply_variable = { population_var = -1 }
	set_variable = { refugees = population_var }
}

add_NTR_traditionalism_influence_dynamic_modifier_effects = {
	set_variable = { NTR_traditionalism_influence_enemy_justify_war_goal_time_var = party_popularity@neutrality }
	
	if = {
		limit = {
			NOT = { has_government = neutrality }
		}
		
		if = {
			limit = {
				has_country_flag = NTR_united_northern_front_flag
			}
			
			set_variable = { NTR_traditionalism_influence_political_power_factor_var = -0.5 }
			set_variable = { NTR_traditionalism_influence_stability_factor_var = -0.5 }
		}
		else = {
			set_variable = { NTR_traditionalism_influence_political_power_factor_var = -1 }
			set_variable = { NTR_traditionalism_influence_stability_factor_var = -1 }
			set_variable = { NTR_traditionalism_influence_war_support_factor_var = -0.5 }
			set_variable = { NTR_traditionalism_influence_conscription_factor_var = -1 }
			set_variable = { NTR_traditionalism_influence_offensive_war_stability_factor_var = -1 }
			
			multiply_variable = { NTR_traditionalism_influence_war_support_factor_var = party_popularity@neutrality }
			multiply_variable = { NTR_traditionalism_influence_conscription_factor_var = party_popularity@neutrality }
			multiply_variable = { NTR_traditionalism_influence_offensive_war_stability_factor_var = party_popularity@neutrality }
		}
	}
	else = {
		set_variable = { NTR_traditionalism_influence_political_power_factor_var = -0.5 }
		set_variable = { NTR_traditionalism_influence_stability_factor_var = 0.25 }
		set_variable = { NTR_traditionalism_influence_war_support_factor_var = -0.25 }
		
		multiply_variable = { NTR_traditionalism_influence_war_support_factor_var = party_popularity@neutrality }
	}
	
	multiply_variable = { NTR_traditionalism_influence_political_power_factor_var = party_popularity@neutrality }
	multiply_variable = { NTR_traditionalism_influence_stability_factor_var = party_popularity@neutrality }
	
	add_dynamic_modifier = { modifier = NTR_traditionalism_influence_dynamic_modifier }
}

add_NTR_communist_partisans_dynamic_modifier_effects = {
	set_variable = { NTR_communist_partisans_political_power_factor_var = -1 }
	set_variable = { NTR_communist_partisans_stability_factor_var = -1 }
	set_variable = { NTR_communist_partisans_war_support_factor_var = -0.5 }
	set_variable = { NTR_communist_partisans_conscription_factor_var = -1 }
	set_variable = { NTR_communist_partisans_offensive_war_stability_factor_var = -1 }
	
	multiply_variable = { NTR_communist_partisans_political_power_factor_var = party_popularity@communism }
	multiply_variable = { NTR_communist_partisans_stability_factor_var = party_popularity@communism }
	multiply_variable = { NTR_communist_partisans_war_support_factor_var = party_popularity@communism }
	multiply_variable = { NTR_communist_partisans_conscription_factor_var = party_popularity@communism }
	multiply_variable = { NTR_communist_partisans_offensive_war_stability_factor_var = party_popularity@communism }
	
	add_dynamic_modifier = { modifier = NTR_communist_partisans_dynamic_modifier }
}

add_NTR_harmonic_tribes_dynamic_modifier_effects = {
	if = {
		limit = {
			has_country_flag = NTR_united_northern_front_flag
		}
		
		set_variable = { NTR_harmonic_tribes_political_power_factor_var = -0.5 }
		set_variable = { NTR_harmonic_tribes_stability_factor_var = -0.5 }
	}
	else = {
		set_variable = { NTR_harmonic_tribes_political_power_factor_var = -1 }
		set_variable = { NTR_harmonic_tribes_stability_factor_var = -1 }
		set_variable = { NTR_harmonic_tribes_war_support_factor_var = -0.5 }
		set_variable = { NTR_harmonic_tribes_conscription_factor_var = -1 }
		set_variable = { NTR_harmonic_tribes_offensive_war_stability_factor_var = -1 }
		
		multiply_variable = { NTR_harmonic_tribes_war_support_factor_var = party_popularity@democratic }
		multiply_variable = { NTR_harmonic_tribes_conscription_factor_var = party_popularity@democratic }
		multiply_variable = { NTR_harmonic_tribes_offensive_war_stability_factor_var = party_popularity@democratic }
	}
	
	multiply_variable = { NTR_harmonic_tribes_political_power_factor_var = party_popularity@democratic }
	multiply_variable = { NTR_harmonic_tribes_stability_factor_var = party_popularity@democratic }
	
	add_dynamic_modifier = { modifier = NTR_harmonic_tribes_dynamic_modifier }
}

NTR_calculate_political_path_if_necessary = {
	if = {
		limit = {
			NOT = {
				OR = {
					has_country_flag = NTR_AI_VEDINA
					has_country_flag = NTR_AI_TRADE
					has_country_flag = NTR_AI_UNITED_NORTH
					has_country_flag = NTR_AI_TOWARDS_REVOLUTION
					has_country_flag = NTR_AI_TRADITIONS
					has_country_flag = NTR_AI_SYNTHESIS
				}
			}
		}
		
		random_list = {
			20 = { set_country_flag = NTR_AI_VEDINA }
			20 = { set_country_flag = NTR_AI_TRADE }
			15 = { set_country_flag = NTR_AI_UNITED_NORTH }
			15 = { set_country_flag = NTR_AI_TOWARDS_REVOLUTION }
			15 = { set_country_flag = NTR_AI_TRADITIONS }
			15 = { set_country_flag = NTR_AI_SYNTHESIS }
			
			# expand for future secret paths #???
		}
	}
}

NTR_set_demilitarized_zones = {
	563 = { set_demilitarized_zone = yes }
	567 = { set_demilitarized_zone = yes }
	573 = { set_demilitarized_zone = yes }
	574 = { set_demilitarized_zone = yes }
	602 = { set_demilitarized_zone = yes }
}

NTR_remove_demilitarized_zones = {
	563 = { set_demilitarized_zone = no }
	567 = { set_demilitarized_zone = no }
	573 = { set_demilitarized_zone = no }
	574 = { set_demilitarized_zone = no }
	602 = { set_demilitarized_zone = no }
}

calculate_NTR_unite_the_tribes_medium_positive_drift_modifiers_effect = {
	set_temp_variable = { NTR_unite_the_tribes_drift_randomizer_temp_var = random } # 0-1
	divide_temp_variable = { NTR_unite_the_tribes_drift_randomizer_temp_var = 20 } # max 0.05
	
	set_variable = { NTR_unite_the_tribes_drift_var = 0.2 }
	
	random_list = {
		50 = { # + (0.2 - 0.25)
			add_to_variable = { NTR_unite_the_tribes_drift_var = NTR_unite_the_tribes_drift_randomizer_temp_var }
		}
		50 = { # (0.2 - 0.15)
			subtract_from_variable = { NTR_unite_the_tribes_drift_var = NTR_unite_the_tribes_drift_randomizer_temp_var }
		}
	}
}

calculate_NTR_unite_the_tribes_small_negative_drift_modifiers_effect = {
	set_temp_variable = { NTR_unite_the_tribes_drift_randomizer_temp_var = random } # 0-1
	divide_temp_variable = { NTR_unite_the_tribes_drift_randomizer_temp_var = 20 } # max 0.05
	
	set_variable = { NTR_unite_the_tribes_drift_var = -0.15 }
	
	random_list = {
		50 = { # (-0.15 - 0.1)
			subtract_from_variable = { NTR_unite_the_tribes_drift_var = NTR_unite_the_tribes_drift_randomizer_temp_var }
		}
		50 = { # + (-0.15 - 0.2)
			add_to_variable = { NTR_unite_the_tribes_drift_var = NTR_unite_the_tribes_drift_randomizer_temp_var }
		}
	}
}

NTR_up_to_pre_industrial_ROOT_effect = {
	if = {
		limit = { has_idea = agrarian_society2 }
		
		swap_ideas = {
			remove_idea = agrarian_society
			add_idea = agrarian_society2
		}
	}
	else_if = {
		limit = { has_idea = agrarian_society3 }
		
		swap_ideas = {
			remove_idea = agrarian_society2
			add_idea = agrarian_society3
		}
	}
	else_if = {
		limit = { has_idea = agrarian_society4 }
		
		swap_ideas = {
			remove_idea = agrarian_society3
			add_idea = agrarian_society4
		}
	}
	else_if = {
		limit = { has_idea = agrarian_society5 }
		
		swap_ideas = {
			remove_idea = agrarian_society4
			add_idea = agrarian_society5
		}
	}
	else = {
		swap_ideas = {
			remove_idea = agrarian_society5
			add_idea = agrarian_society6
		}
	}
}

NTR_up_to_pre_industrial_FROM_effect = {
	if = {
		limit = {
			FROM = { has_idea = modern_society }
		}
		
		if = {
			limit = {
				FROM = {
					any_of_scopes = {
						array = owned_states
						
						is_coastal = yes
					}
				}
			}
			
			add_political_power = -35
		}
		else = {
			add_political_power = -40
		}
	}
	else_if = {
		limit = {
			FROM = {
				check_variable = {
					var = EaW_society_development_var
					compare = greater_than_or_equals
					value = 5
				}
			}
		}
		
		if = {
			limit = {
				FROM = {
					any_of_scopes = {
						array = owned_states
						
						is_coastal = yes
					}
				}
			}
			
			add_political_power = -50
		}
		else = {
			add_political_power = -60
		}
	}
	else_if = {
		limit = {
			FROM = {
				check_variable = {
					var = EaW_society_development_var
					compare = greater_than_or_equals
					value = 4
				}
			}
		}
		
		if = {
			limit = {
				FROM = {
					any_of_scopes = {
						array = owned_states
						
						is_coastal = yes
					}
				}
			}
			
			add_political_power = -65
		}
		else = {
			add_political_power = -80
		}
	}
	else = {
		add_political_power = -100
	}
}

NTR_griffon_race_technologies_show_complete_effect_for_127_days = {
	custom_effect_tooltip = NTR_griffon_race_technologies_effects_tooltip
	
	hidden_effect = {
		set_country_flag = {
			flag = NTR_griffon_race_technologies_cooldown
			value = 1
			days = 127
		}
		
		log = "[GetDateText]: [Root.GetName]: self-triggering event Ntribes.989 started"
		country_event = Ntribes.989
	}
}

NTR_griffon_race_technologies_show_complete_effect_for_85_days = {
	custom_effect_tooltip = NTR_griffon_race_technologies_effects_tooltip
	
	hidden_effect = {
		set_country_flag = {
			flag = NTR_griffon_race_technologies_cooldown
			value = 1
			days = 85
		}
		
		log = "[GetDateText]: [Root.GetName]: self-triggering event Ntribes.989 started"
		country_event = Ntribes.989
	}
}

NTR_remove_griffon_race_technologies_upkeep = {
	hidden_effect = {
		clr_country_flag = NTR_griffon_race_technologies_cooldown
		
		country_event = Ntribes.988
	}
}

NTR_save_random_state_as_target_for_complex = {
	random_owned_controlled_state = {
		limit = {
			free_building_slots = {
				building = industrial_complex
				size > 0
				include_locked = yes
			}
			
			OR = {
				is_in_home_area = yes
				
				NOT = {
					ROOT = {
						any_owned_state = {
							is_in_home_area = yes
							
							free_building_slots = {
								building = industrial_complex
								size > 0
								include_locked = yes
							}
						}
					}
				}
			}
		}
		
		add_extra_state_shared_building_slots = 1
		
		add_building_construction = {
			type = industrial_complex
			level = 1
			instant_build = yes
		}
		
		set_variable = { PREV.NTR_state_with_one_bonus_complex = THIS }
	}
}

NTR_save_random_state_as_target_for_dockyard = { #???
	if = {
		limit = {
			any_owned_state = {
				is_controlled_by = PREV
				is_coastal = yes
			}
			
			NOT = {
				any_owned_state = {
					is_controlled_by = PREV
					
					dockyard > 0
					
					free_building_slots = {
						building = dockyard
						size > 2
						include_locked = yes
					}
				}
			}
		}
		
		random_owned_controlled_state = {
			limit = {
				is_coastal = yes
				
				free_building_slots = {
					building = dockyard
					size > 2
					include_locked = yes
				}
			}
			
			add_extra_state_shared_building_slots = 1
			
			add_building_construction = {
				type = dockyard
				level = 1
				instant_build = yes
			}
			
			set_variable = { PREV.NTR_state_with_one_bonus_dockyard = THIS }
		}
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = naval_effort_built }
			
			any_owned_state = {
				is_controlled_by = PREV
				
				dockyard > 0
				
				free_building_slots = {
					building = dockyard
					size > 1
					include_locked = yes
				}
			}
		}
		
		random_owned_controlled_state = {
			limit = {
				dockyard > 0
				
				free_building_slots = {
					building = dockyard
					size > 1
					include_locked = yes
				}
			}
			
			add_extra_state_shared_building_slots = 1
			
			add_building_construction = {
				type = dockyard
				level = 1
				instant_build = yes
			}
			
			set_variable = { PREV.NTR_state_with_one_bonus_dockyard = THIS }
		}
	}
}

factories_calculation = { # Tribute shit #NotInUse
	set_temp_variable = { industrial_complexes_check = industrial_complex_level }
	divide_temp_variable = { industrial_complexes_check = 2 }
	
	if = {
		limit = {
			check_variable = {
				var = industrial_complexes_check
				compare = not_equals
				value = add_industrial_complexes
			}
		}
		
		var:to_country = {
			add_offsite_building = {
				type = industrial_complex
				level = add_industrial_complexes
			}
		}
		
		multiply_variable = { add_industrial_complexes = -1 }
		
		ROOT = {
			add_offsite_building = {
				type = industrial_complex
				level = add_industrial_complexes
			}
		}
		
		set_variable = { add_industrial_complexes = industrial_complexes_check }
		multiply_variable = { add_industrial_complexes = -1 }
		
		var:to_country = {
			add_offsite_building = {
				type = industrial_complex
				level = add_industrial_complexes
			}
		}
		
		multiply_variable = { add_industrial_complexes = -1 }
		
		ROOT = {
			add_offsite_building = {
				type = industrial_complex
				level = add_industrial_complexes
			}
		}
	}
	
	set_temp_variable = { arms_factories_check = arms_factory_level }
	divide_temp_variable = { arms_factories_check = 2 }
	
	if = {
		limit = {
			check_variable = {
				var = arms_factories_check
				compare = not_equals
				value = add_arms_factories
			}
		}
		
		var:to_country = {
			add_offsite_building = {
				type = arms_factory
				level = add_arms_factories
			}
		}
		
		multiply_variable = { add_arms_factories = -1 }
		
		ROOT = {
			add_offsite_building = {
				type = arms_factory
				level = add_arms_factories
			}
		}
		
		set_variable = { add_arms_factories = arms_factories_check }
		multiply_variable = { add_arms_factories = -1 }
		
		var:to_country = {
			add_offsite_building = {
				type = arms_factory
				level = add_arms_factories
			}
		}
		
		multiply_variable = { add_arms_factories = -1 }
		
		ROOT = {
			add_offsite_building = {
				type = arms_factory
				level = add_arms_factories
			}
		}
	}
}

calculate_military_ai_bahavior = {
	if = {
		limit = { is_ai = yes }
		
		country_event = Ntribes.1000
	}
}