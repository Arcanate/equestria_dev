popularity_clr_junk = {
	clear_variable = NTR_popularity_var
	clear_variable = NTR_popularity_factor
}

population_calculator_multifunctional = {
	if = {
		limit = {
			check_variable = { population > 0 } # check for overflow
		}
		
		divide_variable = { population = ROOT.divider }
		
		#print_variables = {
		#	file = check_effect
		#	text = Population_pre
		#	append = yes
		#	var_list = {
		#		population
		#		ROOT.divider
		#		ROOT.randomizer
		#		ROOT.rounder
		#	}
		#}
		
		set_temp_variable = { population_factor = population }
		multiply_temp_variable = { population_factor = ROOT.randomizer }
		multiply_temp_variable = { population_factor = random }
		
		random_list = {
			50 = {
				multiply_temp_variable = { population_factor = -1 }
			}
			
			50 = {
				# nothing
			}
		}
		
		add_to_variable = { population = population_factor }
		
		divide_variable = { population = ROOT.rounder }
		round_variable = population
		multiply_variable = { population = ROOT.rounder }
		
		#print_variables = {
		#	file = check_effect
		#	text = Population_post
		#	append = yes
		#	var_list = {
		#		population
		#		population_factor
		#	}
		#}
	}
	
	else = {
		set_variable = { population = state_population_k }
		multiply_variable = { population = ROOT.divider }
		
		set_temp_variable = { population_factor = population }
		multiply_temp_variable = { population_factor = ROOT.randomizer }
		multiply_temp_variable = { population_factor = random }
		
		random_list = {
			50 = {
				multiply_temp_variable = { population_factor = -1 }
			}
			
			50 = {
				# nothing
			}
		}
		
		add_to_variable = { population = population_factor }
		multiply_variable = { population = 1000 }
	}
}

population_calculator_multifunctional_k = {
	multiply_variable = { population_k = ROOT.divider }
	
	set_temp_variable = { population_factor_k = population_k }
	multiply_temp_variable = { population_factor_k = ROOT.randomizer }
	
	set_temp_variable = { population_factor_k = random }
	multiply_temp_variable = { population_factor_k = random }
	
	random_list = {
		50 = {
			multiply_temp_variable = { population_factor_k = -1 }
		}
		
		50 = {
			# nothing
		}
	}
	
	add_to_variable = { population_k = population_factor_k }
}

population_calculator_cleaner = {
	clear_variable = divider
	clear_variable = randomizer
	clear_variable = rounder
}

population_calculator_cleaner_k = {
	clear_variable = divider
	clear_variable = randomizer
}

population_calculation_for_sum = {
	add_to_variable = { ROOT.population_sum = population }
	
	add_manpower = population
	
	#print_variables = {
	#	file = check_effect
	#	text = Population_post
	#	append = yes
	#	print_global = yes
	#	var_list = {
	#		population
	#		ROOT.population_sum
	#	}
	#}
}

population_calculation_for_sum_k = {
	add_to_variable = { ROOT.population_sum_k = population_k }
	
	multiply_variable = { population_k = 1000 }
	add_manpower = population_k
}

increase_population_multifunctional_preset = {
	multiply_variable = { population = -1 }
	set_variable = { refugees = population }
}

factories_calculation = {
	set_temp_variable = { industrial_complexes_check = industrial_complex_level }
	divide_temp_variable = { industrial_complexes_check = 2 }
	
	if = {
		limit = {
			check_variable = {
				var = industrial_complexes_check
				value = add_industrial_complexes
				compare = not_equals
			}
		}
		
		var:to_country = {
			add_offsite_building = {
				type = industrial_complex
				level = add_industrial_complexes
			}
		}
		
		multiply_variable = { add_industrial_complexes = -1 }
		
		ROOT = {
			add_offsite_building = {
				type = industrial_complex
				level = add_industrial_complexes
			}
		}
		
		set_variable = { add_industrial_complexes = industrial_complexes_check }
		multiply_variable = { add_industrial_complexes = -1 }
		
		var:to_country = {
			add_offsite_building = {
				type = industrial_complex
				level = add_industrial_complexes
			}
		}
		
		multiply_variable = { add_industrial_complexes = -1 }
		
		ROOT = {
			add_offsite_building = {
				type = industrial_complex
				level = add_industrial_complexes
			}
		}
	}
	
	set_temp_variable = { arms_factories_check = arms_factory_level }
	divide_temp_variable = { arms_factories_check = 2 }
	
	if = {
		limit = {
			check_variable = {
				var = arms_factories_check
				value = add_arms_factories
				compare = not_equals
			}
		}
		
		var:to_country = {
			add_offsite_building = {
				type = arms_factory
				level = add_arms_factories
			}
		}
		
		multiply_variable = { add_arms_factories = -1 }
		
		ROOT = {
			add_offsite_building = {
				type = arms_factory
				level = add_arms_factories
			}
		}
		
		set_variable = { add_arms_factories = arms_factories_check }
		multiply_variable = { add_arms_factories = -1 }
		
		var:to_country = {
			add_offsite_building = {
				type = arms_factory
				level = add_arms_factories
			}
		}
		
		multiply_variable = { add_arms_factories = -1 }
		
		ROOT = {
			add_offsite_building = {
				type = arms_factory
				level = add_arms_factories
			}
		}
	}
}