HIE_Alchemical_Superproject_debug_start = {
	set_country_flag = HIE_ASPJ_is_active
	set_country_flag = HIE_ASPJ_arrows_show
	clear_variable = HIE_created_concoction

	clear_array = HIE_placed_ingredients
	add_to_array = { HIE_placed_ingredients = 0 }
	add_to_array = { HIE_placed_ingredients = 0 }
	add_to_array = { HIE_placed_ingredients = 0 }
	
	# Computes position for the 3 buttons on the tablet
	clear_array = HIE_placed_ingredients_x
	clear_array = HIE_placed_ingredients_y
	add_to_array = { HIE_placed_ingredients_x = 218 }
	add_to_array = { HIE_placed_ingredients_x = 77 }
	add_to_array = { HIE_placed_ingredients_x = 361 }
	add_to_array = { HIE_placed_ingredients_y = 60 }
	add_to_array = { HIE_placed_ingredients_y = 319 }
	add_to_array = { HIE_placed_ingredients_y = 319 }
	
	# Computes ingredients, here for testing, remove later
	clear_array = HIE_ASPJ_ingredientlist
	add_to_array = { HIE_ASPJ_ingredientlist = 1 }
	add_to_array = { HIE_ASPJ_ingredientlist = 2 }
	add_to_array = { HIE_ASPJ_ingredientlist = 3 }
	add_to_array = { HIE_ASPJ_ingredientlist = 4 }
	add_to_array = { HIE_ASPJ_ingredientlist = 5 }
	add_to_array = { HIE_ASPJ_ingredientlist = 6 }
	add_to_array = { HIE_ASPJ_ingredientlist = 7 }
	add_to_array = { HIE_ASPJ_ingredientlist = 8 }
	add_to_array = { HIE_ASPJ_ingredientlist = 9 }
	add_to_array = { HIE_ASPJ_ingredientlist = 10 }
	add_to_array = { HIE_ASPJ_ingredientlist = 11 }
	add_to_array = { HIE_ASPJ_ingredientlist = 12 }
	
	add_to_variable = { HIE_ASPJ_dirty_var = 0.01 }
}

HIE_ASPJ_debug_remove_ingredients = {
	clear_array = HIE_ASPJ_ingredientlist
	add_to_variable = { HIE_ASPJ_dirty_var = 0.01 }
}

HIE_Alchemical_Superproject_start = {
	set_country_flag = HIE_ASPJ_is_active
	set_country_flag = HIE_ASPJ_arrows_show
	clear_array = HIE_placed_ingredients
	add_to_array = { HIE_placed_ingredients = 0 }
	add_to_array = { HIE_placed_ingredients = 0 }
	add_to_array = { HIE_placed_ingredients = 0 }
	
	# Computes position for the 3 buttons on the tablet
	clear_array = HIE_placed_ingredients_x
	clear_array = HIE_placed_ingredients_y
	add_to_array = { HIE_placed_ingredients_x = 218 }
	add_to_array = { HIE_placed_ingredients_x = 77 }
	add_to_array = { HIE_placed_ingredients_x = 361 }
	add_to_array = { HIE_placed_ingredients_y = 60 }
	add_to_array = { HIE_placed_ingredients_y = 319 }
	add_to_array = { HIE_placed_ingredients_y = 319 }
	
	add_to_variable = { HIE_ASPJ_dirty_var = 0.01 }
	
	custom_effect_tooltip = HIE_Alchemical_Superproject_start_tt
}

HIE_ASPJ_evaluate_recipe = {
	# Potion of True Fire
	if = {
		limit = {
			is_in_array = { array = HIE_placed_ingredients value = 1 }
			is_in_array = { array = HIE_placed_ingredients value = 2 }
			is_in_array = { array = HIE_placed_ingredients value = 3 }
		}
		set_variable = { HIE_created_concoction = 1 }
		clear_variable = HIE_ASPJ_selected_formula
		scoped_sound_effect = "HIE_magic_concoction_complete"
		HIE_ASPJ_initiate_30day_cooldown = yes
	}
	# Essense of Endurance
	else_if = {
		limit = {
			is_in_array = { array = HIE_placed_ingredients value = 4 }
			is_in_array = { array = HIE_placed_ingredients value = 5 }
			is_in_array = { array = HIE_placed_ingredients value = 6 }
		}
		set_variable = { HIE_created_concoction = 2 }
		clear_variable = HIE_ASPJ_selected_formula
		scoped_sound_effect = "HIE_magic_concoction_complete"
		HIE_ASPJ_initiate_30day_cooldown = yes
	}
	# Primeval Magic Crystal
	else_if = {
		limit = {
			is_in_array = { array = HIE_placed_ingredients value = 7 }
			is_in_array = { array = HIE_placed_ingredients value = 8 }
			is_in_array = { array = HIE_placed_ingredients value = 9 }
		}
		set_variable = { HIE_created_concoction = 3 }
		clear_variable = HIE_ASPJ_selected_formula
		scoped_sound_effect = "HIE_magic_concoction_complete"
		HIE_ASPJ_initiate_30day_cooldown = yes
	}
	# Essence of Loyalty
	else_if = {
		limit = {
			is_in_array = { array = HIE_placed_ingredients value = 10 }
			is_in_array = { array = HIE_placed_ingredients value = 11 }
			is_in_array = { array = HIE_placed_ingredients value = 12 }
		}
		set_variable = { HIE_created_concoction = 4 }
		clear_variable = HIE_ASPJ_selected_formula
		scoped_sound_effect = "HIE_magic_concoction_complete"
		HIE_ASPJ_initiate_30day_cooldown = yes
	}
	# Failed concoction
	else = {
		clear_variable = HIE_created_concoction
		clear_variable = HIE_ASPJ_selected_formula

		for_each_loop = { # Returns ingredients to ingredients list, empties placed ingredients
			array = HIE_placed_ingredients
			add_to_array = { HIE_ASPJ_ingredientlist = HIE_placed_ingredients^i }
			set_variable = { HIE_placed_ingredients^i = 0 }
		}
		HIE_ASPJ_initiate_90day_cooldown = yes
		country_event = hippone_aspj.0
	}
}

HIE_ASPJ_fire_concoction_event = {
	meta_effect = {
		text = {
			country_event = hippone_aspj.[HIE_event]
		}
		HIE_event = "[?HIE_created_concoction|.0]"
	}

	for_each_loop = {
		array = HIE_placed_ingredients
		set_variable = { HIE_placed_ingredients^i = 0 }
	}
	clear_variable = HIE_created_concoction
	add_to_variable = { HIE_ASPJ_dirty_var = 0.01 }
}

# `set_country_flag` has a days argument but I couldn't dirty var them...
HIE_ASPJ_initiate_30day_cooldown = {
	set_country_flag = HIE_ASPJ_cooldown
	set_variable = { HIE_ASPJ_days_remaining_cooldown = 31 }
	set_temp_variable = { ASPJ_cooldown_pct = 1 }
	add_to_temp_variable = { ASPJ_cooldown_pct = modifier@HIE_ASPJ_cooldown_speed_factor }
	multiply_variable = { HIE_ASPJ_days_remaining_cooldown = ASPJ_cooldown_pct }
	round_variable = HIE_ASPJ_days_remaining_cooldown
	country_event = hippone_aspj.1999
	add_to_variable = { HIE_ASPJ_dirty_var = 0.01 }
}

HIE_ASPJ_initiate_90day_cooldown = {
	set_country_flag = HIE_ASPJ_cooldown
	set_variable = { HIE_ASPJ_days_remaining_cooldown = 91 }
	set_temp_variable = { ASPJ_cooldown_pct = 1 }
	add_to_temp_variable = { ASPJ_cooldown_pct = modifier@HIE_ASPJ_cooldown_speed_factor }
	multiply_variable = { HIE_ASPJ_days_remaining_cooldown = ASPJ_cooldown_pct }
	round_variable = HIE_ASPJ_days_remaining_cooldown
	country_event = hippone_aspj.1999
	add_to_variable = { HIE_ASPJ_dirty_var = 0.01 }
}

# How to use:
# (in effects)
# set_temp_variable = { temp_ingredient = 1 }
# HIE_ASPJ_add_ingredient = yes

# This will add the ingredient with the id of 1 as well as tooltipping it.

HIE_ASPJ_add_ingredient = {
	add_to_array = { HIE_ASPJ_ingredientlist = temp_ingredient }
	custom_effect_tooltip = HIE_ASPJ_add_ingredient_tt
	add_to_variable = { HIE_ASPJ_dirty_var = 0.01 }
}

# Debug, do not use
c_HIE_ASPJ_add_ingredient = {
	set_temp_variable = { temp_ingredient = args^0 }
	HIE_ASPJ_add_ingredient = yes
}