
# Priorities sorting
@tiger_syndicate = 5
@zaga_brothers = 4
@zapsa_syndicate = 3
@zurumilki = 2
@abizaal_syndicate = 1

TRO_CTH_drugs_deccat = {

	### SPECIFIC DEMANDS ###
	
	TRO_CTH_demands = {
		icon = GFX_decision_eng_trade_unions_support
		allowed = { original_tag = TRO }
		visible = {
			OR = {
				has_active_mission = TRO_CTH_ZB_colthaginian_civic_religion
			}
		}
		available = {
			hidden_trigger = {
				always = no
			}
		}
		priority = 6
	}
	TRO_CTH_ZB_colthaginian_civic_religion = {
		allowed = { original_tag = TRO }
		activation = { always = no }
		available = {
			has_country_flag = TRO_CTH_b22_done
		}
		is_good = no
		selectable_mission = no
		days_mission_timeout = 150
		priority = @zaga_brothers
		timeout_effect = {
			set_temp_variable = { temp_idx = 1 }
			set_temp_variable = { temp_p_change = 5 }
			set_temp_variable = { temp_r_change = 10 }
			TRO_drugs_friendly_variables_change = yes
		}
		complete_effect = {
			set_temp_variable = { temp_idx = 1 }
			set_temp_variable = { temp_p_change = -2.5 }
			set_temp_variable = { temp_r_change = -7.5 }
			TRO_drugs_friendly_variables_change = yes
		}
	}
	
	### END SPECIFIC DEMANDS ###
	
	### GENERAL DEMANDS ###
	TRO_CTH_build_civ_demand = {
		allowed = { original_tag = TRO }
		activation = { always = no }
		available = {
			custom_trigger_tooltip = {
				tooltip = TRO_CTH_build_civ_demand_trigger
				var:TRO_civ_demand_state = {
					check_variable = { building_level@industrial_complex = TRO.TRO_civ_demand_num }
				}
			}
		}
		is_good = no
		selectable_mission = no
		days_mission_timeout = 120
		complete_effect = {
			custom_effect_tooltip = TRO_CTH_build_civ_demand_tt
			
			set_temp_variable = { temp_idx = TRO_faction_demanding_civs }
			set_temp_variable = { temp_p_change = 7.5 }
			set_temp_variable = { temp_r_change = 5 }
			TRO_drugs_friendly_variables_change = yes
			
			clear_variable = TRO_faction_demanding_civs
			clear_variable = TRO_civ_demand_state
			clear_variable = TRO_civ_demand_num
			clear_variable = amount_of_civs
		}
		timeout_effect = {
			set_temp_variable = { temp_idx = TRO_faction_demanding_civs }
			set_temp_variable = { temp_p_change = -2.5 }
			set_temp_variable = { temp_r_change = -6 }
			TRO_drugs_friendly_variables_change = yes
			
			clear_variable = TRO_faction_demanding_civs
			clear_variable = TRO_civ_demand_state
			clear_variable = TRO_civ_demand_num
			clear_variable = amount_of_civs
		}
	}
	
	TRO_CTH_build_mil_demand = {
		allowed = { original_tag = TRO }
		activation = { always = no }
		available = {
			custom_trigger_tooltip = {
				tooltip = TRO_CTH_build_mil_demand_trigger
				var:TRO_mil_demand_state = {
					check_variable = { building_level@industrial_complex = TRO.TRO_mil_demand_num }
				}
			}
		}
		is_good = no
		selectable_mission = no
		days_mission_timeout = 100
		complete_effect = {
			custom_effect_tooltip = TRO_CTH_build_mil_demand_tt
			add_stability = -0.05
			
			set_temp_variable = { temp_idx = TRO_faction_demanding_mils }
			set_temp_variable = { temp_p_change = 10 }
			set_temp_variable = { temp_r_change = 5 }
			TRO_drugs_friendly_variables_change = yes
			
			clear_variable = TRO_faction_demanding_mils
			clear_variable = TRO_mil_demand_state
			clear_variable = TRO_mil_demand_num
			clear_variable = amount_of_mils
		}
		timeout_effect = {
			set_temp_variable = { temp_idx = TRO_faction_demanding_mils }
			set_temp_variable = { temp_p_change = -2.5 }
			set_temp_variable = { temp_r_change = -7.5 }
			TRO_drugs_friendly_variables_change = yes
			
			clear_variable = TRO_faction_demanding_mils
			clear_variable = TRO_mil_demand_state
			clear_variable = TRO_mil_demand_num
			clear_variable = amount_of_mils
		}
	}
	
	### HAPPENINGS IN THE UNDERWORLD ###
	TRO_CTH_happenings_in_the_underworld = {
		allowed = { original_tag = TRO }
		activation = { always = no }
		available = {
			hidden_trigger = {
				always = no
			}
		}
		fixed_random_seed = no
		is_good = no
		selectable_mission = no
		days_mission_timeout = 1 # 150
		timeout_effect = {
			hidden_effect = {
				# TFW can't use temp variables because random lists
				
				random_list = {
					1 = { set_variable = { concerning_faction = 0 } }
					1 = { set_variable = { concerning_faction = 1 } }
					1 = { set_variable = { concerning_faction = 2 } }
					1 = { set_variable = { concerning_faction = 3 } }
					1 = { set_variable = { concerning_faction = 4 } }
				}
				random_list = {
					1 = { set_variable = { buildings_amt = 1 } }
					0 = {
						modifier = {
							any_state = {
								check_variable = { TRO_drugs_ruling_cartel = TRO.concerning_faction }
								OR = {
									free_building_slots = {
										building = industrial_complex
										size > 1
									}
									free_building_slots = {
										building = arms_factory
										size > 1
									}
								}
							}
							add = 1
						}
						set_variable = { buildings_amt = 2 }
					}
				}
				random_list = {
				
					### FRIENDLY SECTION ###
					2 = { # Demand civs
						modifier = {
							OR = {
								has_variable = TRO_faction_demanding_civs
								check_variable = { TRO_cartel_action_option^concerning_faction = 2 }
							}
							factor = 0
						}
						set_variable = { TRO_faction_demanding_civs = concerning_faction }
						set_variable = { amount_of_civs = buildings_amt }
						subtract_from_variable = { amount_of_civs = 1 }
						random_owned_state = {
							limit = {
								check_variable = { TRO_drugs_ruling_cartel = TRO.concerning_faction }
								free_building_slots = {
									building = industrial_complex
									size > var:TRO.amount_of_civs
								}
							}
							set_variable = { TRO.TRO_civ_demand_state = THIS }
							set_variable = { TRO.TRO_civ_demand_num = building_level@industrial_complex }
						}
						add_to_variable = { amount_of_civs = 1 }
						add_to_variable = { TRO_civ_demand_num = amount_of_civs }
						country_event = trot_drugs_generic.1
					}
					2 = { # Demand mils
						modifier = {
							OR = {
								has_variable = TRO_faction_demanding_mils
								check_variable = { concerning_faction = 2 }
								check_variable = { TRO_cartel_action_option^concerning_faction = 2 }
							}
							factor = 0
						}
						set_variable = { TRO_faction_demanding_mils = concerning_faction }
						set_variable = { amount_of_mils = buildings_amt }
						subtract_from_variable = { amount_of_mils = 1 }
						random_owned_state = {
							limit = {
								check_variable = { TRO_drugs_ruling_cartel = TRO.concerning_faction }
								free_building_slots = {
									building = arms_factory
									size > var:TRO.amount_of_mils
								}
							}
							set_variable = { TRO.TRO_mil_demand_state = THIS }
							set_variable = { TRO.TRO_mil_demand_num = building_level@arms_factory }
						}
						add_to_variable = { amount_of_mils = 1 }
						add_to_variable = { TRO_civ_demand_num = amount_of_mils }
						country_event = trot_drugs_generic.2
					}
					5 = { # Shootout between cartel and police
						modifier = {
							check_variable = { TRO_cartel_action_option^concerning_faction = 2 }
							factor = 0
						}
						random_owned_state = {
							limit = {
								check_variable = { TRO_drugs_ruling_cartel = concerning_faction }
							}
							set_variable = { ROOT.shootout_state = THIS }
						}
						country_event = trot_drugs_generic.3
					}
					5 = { # Relations improving
						modifier = {
							check_variable = { TRO_cartel_action_option^concerning_faction = 2 }
							factor = 0
						}
						country_event = trot_drugs_generic.4
					}
					4 = { # Raid carried out
						modifier = {
							OR = {
								check_variable = { TRO_cartel_action_option^concerning_faction = 2 }
								check_variable = { concerning_faction = 2 }
							}
							factor = 0
						}
						set_variable = { concerning_faction_2 = 4 }
						subtract_from_variable = { concerning_faction_2 = concerning_faction }
						country_event = trot_drugs_generic.5
					}
					
					### END FRIENDLY SECTION ###
					
				}
				
				clear_variable = buildings_amt
			}
			
			### REMINDER TO SELF: CLEAR TEMP VARIABLES AFTER EACH SECTION OF A RANDOM LIST ###
		}
	}
}

TRO_CTH_the_great_game = {
    TRO_CTH_ignore_north_zebrica = {
		icon = eng_trade_unions_support
		available = {
		    NOT = {
			    has_country_flag = TRO_CTH_already_negotiating
			}
		}
		visible = {
			has_completed_focus = TRO_CTH_e5
			OR = {
				NOT = {
			    	has_country_flag = TRO_CTH_decided_upon_north_zebrica
				}
				BAT = {
				    has_country_flag = BAT_HIP_defeated
				}
			}
		}
		ai_will_do = {
			factor = 0
		}

		cost = 0
		fire_only_once = yes

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision TRO_CTH_ignore_north_zebrica"
			if = {
			    limit = {
				    HIP = {
					    NOT = {
						    has_government = neutrality
						}
					}
					BAT = {
					    has_country_leader = { 
		                    character = BAT_ocean_spray
			                ruling_only = yes
		                }
					}
				}
				custom_effect_tooltip = TRO_CTH_gain_5_points_tp
				add_to_variable = { 
					var = TRO_CTH_geopolitics_points
                	value = 5				
				}
			}
			else_if = {
			    limit = {
				    OR = {
				        HIP = {
					        NOT = {
						        has_government = neutrality
						    }
					    }
					    BAT = {
					        has_country_leader = { 
		                        character = BAT_ocean_spray
			                    ruling_only = yes
		                    }
					    }
					}
				}
				custom_effect_tooltip = TRO_CTH_gain_10_points_tp
			    add_to_variable = { 
					var = TRO_CTH_geopolitics_points
                	value = 10
				}
			}
			else = {
			    custom_effect_tooltip = TRO_CTH_gain_15_points_tp
			    add_to_variable = { 
					var = TRO_CTH_geopolitics_points
                	value = 15
				}
			}
			hidden_effect = {
			    set_country_flag = TRO_CTH_decided_upon_north_zebrica
			}
		}
	}
	
	TRO_CTH_negotiate_with_hippogriffia = {
		icon = eng_trade_unions_support
		available = {
		    NOT = {
			    has_country_flag = TRO_CTH_already_negotiating
			}
		}
		visible = {
			has_completed_focus = TRO_CTH_e5
			HIP = {
				has_government = neutrality
			}
			NOT = {
			    has_country_flag = TRO_CTH_decided_upon_north_zebrica
				BAT = {
				    has_country_flag = BAT_HIP_defeated
				}
			}
		}
		ai_will_do = {
			factor = 10
		}

		cost = 0
		fire_only_once = yes

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision TRO_CTH_negotiate_with_hippogriffia"
			country_event = {
				id = trotkart_colthage.50
			}
			hidden_effect = {
			    set_country_flag = TRO_CTH_already_negotiating
			}
		}
	}
	
	TRO_CTH_negotiate_with_chiropterra = {
		icon = eng_trade_unions_support
		available = {
		    NOT = {
			    has_country_flag = TRO_CTH_already_negotiating
			}
		}
		visible = {
			has_completed_focus = TRO_CTH_e5
			BAT = {
			    NOT = {
					has_country_leader = { 
		                character = BAT_ocean_spray
			            ruling_only = yes
		            }
				}
			}
			NOT = {
			    has_country_flag = TRO_CTH_decided_upon_north_zebrica
				BAT = {
				    has_country_flag = BAT_HIP_defeated
				}
			}
		}
		ai_will_do = {
			factor = 10
		}

		cost = 0
		fire_only_once = yes

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision TRO_CTH_negotiate_with_chiropterra"
			country_event = {
				id = trotkart_colthage.59
			}
			hidden_effect = {
			    set_country_flag = TRO_CTH_already_negotiating
			}
		}
	}
	
    TRO_CTH_fight_communism = {
		icon = hol_war_on_pacifism
		available = {
			is_subject = no
			NOT = {
			    has_country_flag = TRO_CTH_preparing_an_attack
			}
		}
		targets = { 
			MIT SIC CYA FAL WNG HIN CTL MCW HRV
		}
		target_trigger = {
			FROM = {  
			    OR = {
			        original_tag = MIT
					original_tag = SIC
					original_tag = CYA
					original_tag = FAL
					original_tag = WNG
					original_tag = HIN
					original_tag = CTL
					original_tag = MCW
					original_tag = HRV
				}
			}
		}
		targets_dynamic = yes
		target_root_trigger = {
		    has_completed_focus = TRO_CTH_e7
		}
		visible = {
		    has_completed_focus = TRO_CTH_e7
			FROM = {
				exists = yes
				NOT = {
					is_subject_of = ROOT
				}
				has_government = communism
				NOT = {
				    is_in_faction_with = ROOT
				}
				NOT = { 
				    has_war_with = ROOT 
				}
			}
		}
		cancel_trigger = {
			OR = {
				is_subject = yes
				FROM = {
					OR = {
						exists = no
						is_subject_of = ROOT
						has_war_with = ROOT
						is_in_faction_with = ROOT
					}
					NOT = {
					    has_government = communism
					}
				}
			}
		}
		cancel_effect = {
		    hidden_effect = {
			    clr_country_flag = TRO_CTH_preparing_an_attack
			}
		}
		
		cost = 75
		fire_only_once = yes
		
		days_remove = 30
		war_with_target_on_remove = yes
		
		ai_will_do = {
			factor = 100
			modifier = {
				factor = 0
				has_war = yes
			}
		}
		
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision TRO_CTH_fight_communism_and_kasa target: [From.GetName]"
			FROM = {
                add_ai_strategy = {
                    type = prepare_for_war
                    id = ROOT
                    value = 1000
                }
            }
			hidden_effect = {
			    set_country_flag = TRO_CTH_preparing_an_attack
			}
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove TRO_CTH_fight_communism_and_kasa target: [From.GetName]"
			FROM = {
                add_ai_strategy = {
                    type = prepare_for_war
                    id = ROOT
                    value = -1000
                }
            }
			declare_war_on = {
                target = FROM
                type = annex_everything
            }
			hidden_effect = {
			    clr_country_flag = TRO_CTH_preparing_an_attack
				create_wargoal = { 
					type = annex_everything 
					target = FROM
				}
				if = {
				    limit = {
					    FROM = {
						    is_ai = no
						}
					}
					country_event = { 
						id = trotkart_colthage.50
					}
				} 
			}
		}
	}
	
	TRO_CTH_fight_communism_2 = {
		icon = hol_war_on_pacifism
		available = {
			is_subject = no
			NOT = {
			    has_country_flag = TRO_CTH_preparing_an_attack
			}
		}
		targets = { 
			ZES
		}
		target_trigger = {
			FROM = {  
			    OR = {
			        original_tag = ZES
				}
			}
		}
		targets_dynamic = yes
		target_root_trigger = {
		    has_completed_focus = TRO_CTH_e7
		}
		visible = {
		    has_completed_focus = TRO_CTH_e7
			FROM = {
				exists = yes
				NOT = {
					is_subject_of = ROOT
				}
				OR = {
					has_government = communism
					has_government = democratic
				}
				NOT = {
				    is_in_faction_with = ROOT
				}
				NOT = { 
				    has_war_with = ROOT 
				}
			}
		}
		cancel_trigger = {
			OR = {
				is_subject = yes
				FROM = {
					OR = {
						exists = no
						is_subject_of = ROOT
						has_war_with = ROOT
						is_in_faction_with = ROOT
					}
					NOT = {
					    OR = {
					        has_government = communism
							has_government = democratic
						}
					}
				}
			}
		}
		cancel_effect = {
		    hidden_effect = {
			    clr_country_flag = TRO_CTH_preparing_an_attack
			}
		}
		
		cost = 75
		fire_only_once = yes
		
		days_remove = 30
		war_with_target_on_remove = yes
		
		ai_will_do = {
			factor = 100
			modifier = {
				factor = 0
				has_war = yes
			}
		}
		
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision TRO_CTH_fight_communism_and_kasa target: [From.GetName]"
			FROM = {
                add_ai_strategy = {
                    type = prepare_for_war
                    id = ROOT
                    value = 1000
                }
            }
			hidden_effect = {
			    set_country_flag = TRO_CTH_preparing_an_attack
			}
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove TRO_CTH_fight_communism_and_kasa target: [From.GetName]"
			FROM = {
                add_ai_strategy = {
                    type = prepare_for_war
                    id = ROOT
                    value = -1000
                }
            }
			declare_war_on = {
                target = FROM
                type = annex_everything
            }
			hidden_effect = {
			    clr_country_flag = TRO_CTH_preparing_an_attack
				create_wargoal = { 
					type = annex_everything 
					target = FROM
				}
				if = {
				    limit = {
					    FROM = {
						    is_ai = no
						}
					}
					country_event = { 
						id = trotkart_colthage.50
					}
				} 
			}
		}
	}
}