
##### ###  ### ##### ### #   #  ###
  #   #   #      #    #  ##  # #   
  #   ##   ##    #    #  # # # #  ##
  #   #      #   #    #  #  ## #   #
  #   ### ###    #   ### #   #  ###
 
#NCH_trade_crisis = {
	
#		NCH_inevitable_crisis = {

#		priority = 10

#		icon = generic_ignite_civil_war

#		available = {
#			hidden_trigger = { always = no }
#		}

#		days_mission_timeout = 250

#		fire_only_once = yes

#		activation = {
#			has_country_flag = NCH_start_trading_flag
#			NOT = { has_global_flag = spanish_civil_war }
#		}

#		visible = {
#			tag = NCH
#			has_completed_focus = SPA_a_great_spain
#			has_country_flag = SPR_spanish_elections_flag
#			NOT = { has_global_flag = spanish_civil_war }
#		}

#		cancel_if_not_visible = yes

#		is_good = yes

#		timeout_effect = {
#			country_event = lar_spain.2
#			if = {
#				limit = {
#					has_idea = SPA_awaiting_the_rebellion
#				}
#				remove_ideas = SPA_awaiting_the_rebellion
#			}
#		}
#	}
#		icon = {
#			key = spa_garrison_control_none
#			trigger = {
#				has_completed_focus = SPA_a_great_spain
#				455 = { check_variable = { var = SPA_garrison_control value = 1 compare = equals } }
#			}
#		}
#		icon = {
#			key = spa_garrison_control_weak
#			trigger = {
#				has_completed_focus = SPA_a_great_spain
#				455 = {
#					check_variable = { var = SPA_garrison_control value = 2 compare = equals }
#					NOT = { has_state_flag = SPA_northern_garrisons_state_flag }
#				}
#			}
#		}
#		icon = {
#			key = spa_garrison_control_weak2
#			trigger = {
#				has_completed_focus = SPA_a_great_spain
#				455 = {
#					check_variable = { var = SPA_garrison_control value = 2 compare = equals }
#					has_state_flag = SPA_northern_garrisons_state_flag
#				}
#			}
#		}
#		icon = {
#			key = spa_garrison_control_strong
#			trigger = {
#				has_completed_focus = SPA_a_great_spain
#				455 = {
#					check_variable = { var = SPA_garrison_control value = 3 compare = equals }
#					NOT = { has_state_flag = SPA_northern_garrisons_state_flag }
#				}
#			}
#		}
#		icon = {
#			key = spa_garrison_control_strong2
#			trigger = {
#				has_completed_focus = SPA_a_great_spain
#				455 = {
#					check_variable = { var = SPA_garrison_control value = 3 compare = equals }
#					has_state_flag = SPA_northern_garrisons_state_flag
#				}
#			}
#		}
#		icon = {
#			key = spa_garrison_control_total
#			trigger = {
#				has_completed_focus = SPA_a_great_spain
#				455 = { check_variable = { var = SPA_garrison_control value = 4 compare = greater_than_or_equals } }
#			}
#		}
#		icon = {
#			key = spr_garrison_control_none
#			trigger = {
#				has_completed_focus = SPR_the_popular_front
#				455 = { check_variable = { var = SPA_garrison_control value = 1 compare = equals } }
#			}
#		}
#		icon = {
#			key = spr_garrison_control_weak
#			trigger = {
#				has_completed_focus = SPR_the_popular_front
#				455 = {
#					check_variable = { var = SPA_garrison_control value = 2 compare = equals }
#					NOT = { has_state_flag = SPA_northern_garrisons_state_flag }
#				}
#			}
#		}
#		icon = {
#			key = spr_garrison_control_weak2
#			trigger = {
#				has_completed_focus = SPR_the_popular_front
#				455 = {
#					check_variable = { var = SPA_garrison_control value = 2 compare = equals }
#					has_state_flag = SPA_northern_garrisons_state_flag
#				}
#			}
#		}
#		icon = {
#			key = spr_garrison_control_strong
#			trigger = {
#				has_completed_focus = SPR_the_popular_front
#				455 = {
#					check_variable = { var = SPA_garrison_control value = 3 compare = equals }
#					NOT = { has_state_flag = SPA_northern_garrisons_state_flag }
#				}
#			}
#		}
#		icon = {
#			key = spr_garrison_control_strong2
#			trigger = {
#				has_completed_focus = SPR_the_popular_front
#				455 = {
#					check_variable = { var = SPA_garrison_control value = 3 compare = equals }
#					has_state_flag = SPA_northern_garrisons_state_flag
#				}
#			}
#		}
#		icon = {
#			key = spr_garrison_control_total
#			trigger = {
#				has_completed_focus = SPR_the_popular_front
#				455 = { check_variable = { var = SPA_garrison_control value = 4 compare = greater_than_or_equals } }
#			}
#		}
#
#		available = {
#			has_full_control_of_state = 455
#			if = {
#				limit = {
#					has_completed_focus = SPA_a_great_spain
#				}
#				custom_trigger_tooltip = {
#					tooltip = SPA_expand_influence_nationalists_trigger_tt
#					455 = { check_variable = { var = SPA_garrison_control value = 4 compare = less_than } }
#				}
#			}
#			if = {
#				limit = {
#					has_completed_focus = SPR_the_popular_front
#				}
#				custom_trigger_tooltip = {
#					tooltip = SPR_expand_influence_republicans_trigger_tt
#					455 = { check_variable = { var = SPA_garrison_control value = 2 compare = greater_than_or_equals } }
#				}
#			}
#			NOT = {
#				has_country_flag = SPA_already_expanding_influence_flag
#			}
#		}

#		highlight_state_targets = { state = 455 }

#		on_map_mode = map_only

#		cost = 455.SPA_garrison_control_cost?10

#		fire_only_once = no

#		days_remove = 14

#		visible = {
#			NOT = { has_global_flag = spanish_civil_war }
#			has_country_flag = SPR_spanish_elections_flag
#		}

#		cancel_if_not_visible = yes

# 	complete_effect = {
#			set_country_flag = SPA_already_expanding_influence_flag
#		}

#		remove_effect = {
#			if = {
#				limit = {
#					has_completed_focus = SPA_a_great_spain
#				}
#				455 = {
#					custom_effect_tooltip = SPA_expand_influence_nationalists_tt
#					hidden_effect = {
#						if = {
#							limit = { check_variable = { SPA_garrison_control < 4 } }
#							
#							add_to_variable = { var = SPA_garrison_control value = 1 }
#							SPR = { add_to_variable = { var = spa_civil_war_divisions_counter_var value = 1 } }
#							SPR = { subtract_from_variable = { var = spr_civil_war_divisions_counter_var value = 1 } }
#						}
#					}
#					SPA_garrison_control_tooltip = yes
#					SPA_garrison_control_cost_calculation = yes
#				}
#			}
#			if = {
#				limit = {
#					has_completed_focus = SPR_the_popular_front
#				}
#				455 = {
#					custom_effect_tooltip = SPR_expand_influence_republicans_tt
#					hidden_effect = {
#						subtract_from_variable = { var = SPA_garrison_control value = 1 }
#						SPR = { subtract_from_variable = { var = spa_civil_war_divisions_counter_var value = 1 } }
#						SPR = { add_to_variable = { var = spr_civil_war_divisions_counter_var value = 1 } }
#					}
#					SPA_garrison_control_tooltip = yes
#					SPR_garrison_control_cost_calculation = yes
#				}
#			}
#			clr_country_flag = SPA_already_expanding_influence_flag
#		}
#
#		ai_will_do = {
#			base = 110
#			modifier = {
#				455 = { has_state_flag = SPR_recently_expanded_influence_flag }
#				factor = 10
#			}
#			modifier = {
#				has_completed_focus = SPA_a_great_spain
#				NOT = { has_completed_focus = SPA_secure_the_northern_garrisons }
#				factor = 0
#			}
#			modifier = {
#				has_completed_focus = SPA_a_great_spain
#				455 = { check_variable = { var = SPA_garrison_control value = 2 compare = greater_than_or_equals } }
#				factor = 5
#			}
#			modifier = {
#				has_completed_focus = SPA_a_great_spain
# 			455 = { check_variable = { var = SPA_garrison_control value = 3 compare = greater_than_or_equals } }
#				factor = 5
#			}
#			modifier = {
#				has_completed_focus = SPA_a_great_spain
#				is_historical_focus_on = yes
#				factor = 10
#			}
#		}
#	}
#}

NCH_marriages = {

	NCH_marry_cenhelm_decision = {
		icon = GFX_decision_wedding

		cost = 200
		ai_will_do = {
			factor = 10
		}
		fire_only_once = yes

		visible = {
			has_government = democratic
			NOT = {
				has_country_flag = NCH_having_crisis_flag
			}
			FROM = {
				has_idea = NCH_trading_with_NCH_harmonic
			}
		}
		target_root_trigger = {
			has_government = democratic
		}
		targets = { FBK }
		target_trigger = {
			FROM = { tag = FBK }
		}


		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision NCH_marry_cenhelm_decision target: [From.GetName]"
			add_ideas = NCH_marriage_cenhelm_idea
			diplomatic_relation = {
				country = FROM
				relation = non_aggression_pact
				active = yes
			}
			give_guarantee = FROM
			FROM = {
				give_guarantee = ROOT
			}
		}
	}
}

Remove_NCH_trade_category = {
	Remove_NCH_trade = {
		icon = decision_infiltrate_state

		cost = 50
		ai_will_do = {

			factor = 1

			modifier = {
				has_idea = NCH_trading_with_NCH_harmonic
				factor = 0.01
			}
			modifier = {
				has_idea = NCH_trading_with_NCH_fascist
				factor = 80
			}
		}


		fire_only_once = yes

		visible = {
			is_trading_with_NCH = yes
		}
		target_root_trigger = {
			is_trading_with_NCH = yes
		}
		targets = { NCH }
		target_trigger = {
			FROM = { tag = NCH }
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision Remove_NCH_trade target: [From.GetName]"
			if = {
				limit = {
					has_idea = NCH_trading_with_NCH_harmonic
				}
				remove_ideas = NCH_trading_with_NCH_harmonic
			}

			if = {
				limit = {
					has_idea = NCH_trading_with_NCH_fascist
				}
				remove_ideas = NCH_trading_with_NCH_fascist
			}

			remove_opinion_modifier = {
				modifier = NCH_negative_trading target = FROM
			}
			remove_opinion_modifier = {
				modifier = trading target = FROM
			}

			FROM = {
				country_event = greneclyf.61
				hidden_effect = {
					add_to_variable = {
						var = NCH_trade_partners_iter
						value = -1
					}
					add_to_variable = { var = gytha_sanity value = 1 }
				}
				NCH_get_trading_idea = yes
			}
		}
	}
}

NCH_crisis_category = {

	NCH_crisis = {
		icon = griffon_bandits
		allowed = { tag = NCH }
		fire_only_once = yes
		available = {
			check_variable = {
				var = NCH_Crisis_Resolve_Points
				value = 4
				compare = equals
			}

		}
		activation = {
			has_country_flag = NCH_having_crisis_flag
		}
		is_good = no
		days_mission_timeout = 140
		timeout_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision timeout NCH_crisis"
			country_event = greneclyf_crisis.8
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision NCH_crisis"
			country_event = greneclyf_crisis.9
		}
	}
}